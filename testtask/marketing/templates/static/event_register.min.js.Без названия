var __extends=this&&this.__extends||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);function o(){this.constructor=e}e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},TWF2;!function(TWF2){var WidgetPrototypes;!function(WidgetPrototypes){var event_register=function(_super){function event_register(e){this.eventCache={},this.defaultQuestions=[],this.flags={multiankSelectsReplaced:!1,reportedFillFormEvent:!1,loadingEvent:!1,ankInitialized:!1},this.lazyPackages={postprocessRecurringEvent:["momentjs"]},this.packages=["jquery","mustache"],TWF2.packages.polyfills&&this.packages.push("polyfills"),this.routes={main:{},success:{},tlen:{},pending:{},pay:{},charity:{},button:{},widget_error:{},select_date:{},tickets:{}},this.settings={protocol:"https:",iframe:{width:"100%",height:200,autoHeight:!0,background:"transparent"},use_ticket_remind:!0,popup:{width:600,autoShrink:!0,minViewport:310,closeConfirm:{texts:{title:"Закончить регистрацию?",description:"После этого вернуть введенные вами данные будет невозможно.",close:"Завершить",proceed:"Нет, продолжить"},routes:["main","pay"]},tintColor:"rgba(0,0,0,.8)"},addFormData:{},utmForward:!0,forwardReferer:!0,forwardZeroReferer:"auto",buttonSettings:{css:{},text:null,height:44},mainFormButtonSettings:{texts:{proceed:"Продолжить",buy:"Купить",buy_ticket:"Купить билет",items:["билет","билеты"],register:"Зарегистрироваться",atleast:"Выберите хотя бы один билет"}},display:"iframe",multiankSettings:{addFirstAttendee:!1,distinguishFirstAttendee:!0,initialSelects:!0},trackers:{cube:{enable:!1,sig:"4f08dd3ecb2d2c9e66037e2628389ec9"},ref:{enable:!0},ga:{enable:!0,trackerName:"tpw",trackerId:"UA-5678806-1"}},load_org_trackers:!0,forwardCookies:["in_campaigns","__utmz"],hideFormsWhenNoTickets:!0,hidePromocodeInput:"on-prefill",recurringDatesMode:"auto",recurringShowEmptyIntervals:!1,recurringVerticalCompress:1,cloudPaymentKey:null,issueTickets:!0,prefill:{aux:{},auto:!0,auto_prefix:"twf_prefill_"},use_plusminus:!0,plusminus_burst_protection:"auto",locale:null,dada_config:{api_key:"a609805753dd760bf5699c79cd036e5014f84ce3",type:"PARTY",count:4},send_roistat:!0,display_discounted_ticket_types:!0},_super.call(this,e)}return __extends(event_register,_super),event_register.prototype.ready=function(){var _this=this,w=this,m=this.model,co=this.customizationOwner,s=this.settings,F=TWF2.Util.F,C=TWF2.Collections,U=TWF2.Util,l=this.mklog("ready"),el,sel;if(C.H.each(this.lazyPackages,function(e){return _this.context.loadPackages(e,function(){})}),m.host=w.context.base,m.event=TWF2.cascade(m.event||{},s.event),m.wclasses=s.widgetClass,m.prefill=s.prefill,m.formData={},m.enteredPromocodes=[],m.isInTimepad=0<=document.location.href.search(this.context.baseDomain)&&!this.settings.iframe.useVkScroll,m.isInPaymentPage=s.isInPaymentPage,m.showEventDetailsAtPayment=s.showEventDetailsAtPayment||"pay"===s.initialRoute,m.prefill.auto){var pfl=this.mklog("auto_prefill");pfl("Auto-prefill from url ENABLED");var url=this.getEmbedderUrl(),qs=U.QueryString.fromUrl(url),rx_1=new RegExp("^"+this.settings.prefill.auto_prefix),prefill_fragments=C.H.where(qs.fragments,function(e,t){return!!t.match(rx_1)}),rebuilt_qs_pairs_1=[],rebuilt_qs=void 0;if(pfl("Processed url: %s, fragments extracted: %O",url,prefill_fragments),C.H.each(prefill_fragments,function(e,t){rebuilt_qs_pairs_1.push(t.replace(rx_1,"")+"="+encodeURIComponent(e))}),rebuilt_qs=rebuilt_qs_pairs_1.join("&"),pfl("Rebuilt queryString for deparam: %s",rebuilt_qs),U.QueryString.deparam){var deparamed_prefill=U.QueryString.deparam(rebuilt_qs);pfl("Decoded prefills: %O",deparamed_prefill),this.settings.prefill=TWF2.extend(this.settings.prefill,deparamed_prefill)}else pfl("Old loader.ts stuck in cache, no deparam available yet :(")}if(m.event&&m.event.locale){var setLoc=this.settings.locale||m.event.locale;l("Setting locale to %s",setLoc),this.switchLocale(setLoc)}!co&&m.event.org&&(l("Applying customization owner org: %d",m.event.org),this.customizationOwner={ownerType:"organization",id:m.event.org}),w.obs.listen("switchedToNewRenderTarget",function(){l("Default switchedToNewRenderTarget handler fired, setting $.ons"),w.$currentDocumentNode.on("submit","#eventreg_form",function(e){return _this.eventRegister(e)}),w.$currentDocumentNode.on("click",".promocode_link a",function(e){return _this.askPromocode(e)}),w.$currentDocumentNode.on("submit",".js-section-promocodeBlock",function(e){return _this.handleApplyPromocode(e)}),w.$currentDocumentNode.on("change",".js-tickets_count_input,.b-reg-table__select",function(e){return _this.handleTicketsSelection()}),w.$currentDocumentNode.on("click","a.redirect",function(e){return _this.handleRedirectingA(e)}),w.$currentDocumentNode.on("click","a.add-attendee",function(e){return _this.handleAddAttendeeForm(e)}),w.$currentDocumentNode.on("click","a.add-attendees",function(e){return _this.addAttendeeForms(e)}),w.$currentDocumentNode.on("click",".js-date-choice",function(e){return _this.handleSelectEventDate(e)}),w.$currentDocumentNode.on("click",".js-open-date-choice",function(e){return _this.handleOpenSelectEventDate(e)}),w.$currentDocumentNode.on("click","button.open_widget",function(e){return _this.handleOpenWidgetInPopup(e)}),w.$currentDocumentNode.on("change","#eventreg_form input, #eventreg_form textarea",function(e){return _this.handleReportFillForm()}),w.$currentDocumentNode.on("click",".b-payment__event-more-link",function(e){return _this.handleToggleImageHeader(e)}),w.$currentDocumentNode.on("click",".js-schk-wrap_preview",function(e){_this.openSeatcheckModal(),e.preventDefault()}),w.$currentDocumentNode.on("change",".js-section-ank input",F.once(_this,function(e){return _this.notifyTrackers("edited field eventRegister")})),w.$currentDocumentNode.on("click","a.b-payment__method",function(e){return _this.notifyTrackers("clicked button eventPaymentTypes",{event_value:_this.model.order.payment.sum_org})}),w.$currentDocumentNode.on("click",".send-pay-request a",function(e){return _this.sendPayRequest(e)}),w.$currentDocumentNode.on("click","#places_list .close",function(e){return _this.removePlaceFromList(e)}),w.$currentDocumentNode.on("change",'input[name ^= "accepted_terms"]',function(){return _this.processSeletedTickets()}),w.$currentDocumentNode.on("click",".js-section-submit",function(e){return _this.showTermsAcceptPopup(e)}),w.$currentDocumentNode.on("change",'[name="user_forms[0][mail]"], [name="order_mail"]',function(e){_this.model.event&&_this.model.event.policy_features&&_this.model.event.policy_features.email&&_this.recountSelectedTickets()}),w.$currentDocumentNode.on("click",".js-verify-btn, .js-verify-resend",function(e){return _this.handlePhoneVerifySend(e)}),w.$currentDocumentNode.on("change keyup",".js-verify-code",function(e){return _this.handlePhoneVerifyInput(e)}),w.$currentDocumentNode.on("change keyup",".js-verify-phone",function(e){return _this.handlePhoneRequiresVerificationChange(e)}),w.$currentDocumentNode.on("click",".js-charity-show",function(e){return _this.handleCharity(e,"show")}),w.$currentDocumentNode.on("click",".js-charity-hide",function(e){return _this.handleCharity(e,"hide")}),w.$currentDocumentNode.on("change",".js-charity-checkbox",function(e){return _this.handleCharity(e,"checkbox")}),w.$currentDocumentNode.on("click",".js-vkpay",function(e){return _this.handleShowVKPay(e)}),_this.loadSvoge(_this.currentWindowNode)}),w.obs.listen("postRepaint",function(e){var t=!1;if("main"==e.tpl){if(_this.settings.use_plusminus){var i={logger:_this.mklog("plusminus"),allow_zero_below_min:!0},o=navigator.userAgent.toLowerCase(),n=o.indexOf("chrome")<0&&0<o.indexOf("safari")&&o.substr(o.indexOf("version/")+"version/".length,3);"auto"===_this.settings.plusminus_burst_protection?i.burst_timeout=_this.model.event.uses_policies?500:200:i.burst_timeout=+_this.settings.plusminus_burst_protection,TWF2.Util.isMobileBrowser()&&(i.logger("it's a mobile device, disable hovers"),_this.$$(".b-reg-table__plusminus_btn").removeClass("not-touch")),TWF2.JQueryCommon.$plusMinus(_this.$$(".js-plusminus"),i,function(o,n){var e=_this.model.event.tickets_left;if(!e)return n;var r=0;return _this.$$(".js-plusminus").each(function(e,t){if(t==o.get(0))r+=n;else{var i=_this.T$(t).find(".js-plusminus_value").val();r+=+i||0}}),e<r?n-(r-e):n}),n&&n<9&&_this.$$(".js-svoge-fallback").TWFiter(function(e){var t=_this.T$("<span></span>").addClass("b-reg-table__plusminus_fallback");e.hasClass("js-plusminus_plus")?t.text("+"):e.hasClass("js-plusminus_minus")&&t.text("-"),e.html(t).removeClass("js-svoge-fallback")})}if(w.model.event.uses_multiank&&(_this.log("[Recounts] postRepaint multiank update"),_this.flags.multiankSelectsReplaced=!1,w.model.attendees.length&&w.addAttendeeFormHandlers(w.$$(".b-attendee"),w.model.attendees[0])),w.model.event.has_active_places&&(_this.loadSeatcheck(),t=!0,w.settings.iframe.useVkScroll&&window.VK))try{_this.log("[postRepaint][VK] override onScrollTop callback"),window.VK.init(function(){window.VK.addCallback("onScrollTop",function(e,t,i,o){_this.currentWindowNode.seatcheck&&(i=100<i?100:i,_this.currentWindowNode.seatcheck.vkMaxHeight=t-i,_this.currentWindowNode.seatcheck.vkOffset=i,_this.log("[Seatcheck][VK] max height is set"))}),window.VK.addCallback("onScroll",function(e,t){if(_this.currentWindowNode.seatcheck){var i=_this.currentWindowNode.seatcheck.vkOffset;_this.currentWindowNode.seatcheck.vkScroll=0<e-i+42?e-i+42:0,_this.log("[Seatcheck][VK] scroll recalculated")}}),window.VK.callMethod("scrollSubscribe",!0)})}catch(e){_this.log("[postRepaint][VK] onScrollTop callback overriding failed: "+e)}if(w.model.event.uses_processing_personal_data&&(_this.currentWindowNode.covidDataPopap={},w.settings.iframe.useVkScroll&&window.VK))try{window.VK.init(function(){window.VK.addCallback("onScrollTop",function(e,t,i,o){i=100<i?100:i,_this.currentWindowNode.covidDataPopap.vkMaxHeight=t-i,_this.currentWindowNode.covidDataPopap.vkOffset=i}),window.VK.addCallback("onScroll",function(e,t){var i=_this.currentWindowNode.covidDataPopap.vkOffset;_this.currentWindowNode.covidDataPopap.vkScroll=0<e-i+42?e-i+42:0}),window.VK.callMethod("scrollSubscribe",!0)})}catch(e){_this.log("[postRepaint][VK] onScrollTop callback overriding failed: "+e)}t||_this.recountSelectedTickets(),w.model.event.uses_file_upload&&_this.loadUploadcare(),_this.model.event.uses_phone&&_this.loadTPPhone().done(function(){return _this.$$("[data-type=phone] input.js-tpphone").tpphone()}),C.A.any(_this.model.event.questions,function(e){return e.meta.dadata})&&_this.attachDadata()}w.$$(".b-reg-descr, .b-registration__notice").find("a").attr("target","_blank")}),w.obs.listen("attendeeFormAdded",function(){C.A.any(_this.model.event.questions,function(e){return e.meta&&e.meta.dadata})&&_this.attachDadata()}),this.settings.addModelCache&&(l("Injecting model cache"),TWF2.Collections.H.each(this.settings.addModelCache,function(mId,k){sel="script#"+mId,_this.log("[POSTINIT] preloading model cache: "+k+" <= "+sel),el=_this.T$(sel).get(0),_this.eventCache[k]=eval(_this.context.loader.extractScriptSrc(el))}));"button"===this.settings.initialRoute&&(l("Initial route = button, overriding iframe stuff"),this.settings.iframe.autoHeight=!1,this.settings.iframe.height=this.settings.buttonSettings.height,this.settings.iframe.background="transparent"),"squish"===this.settings.recurringDatesMode&&(l("Overriding squishRecurringDates"),this.model.squishRecurringDates=!0),this.obs.listen("seatcheckReady",function(){_this.model.event.uses_preloader?_this.initializePreloader():_this.loadSeatcheckData(),_this.settings.iframe.useVkScroll&&window.VK&&window.VK.callMethod("scrollTop")}),this.obs.listen("trackingWidgetLoaded",F.once(this,function(){return _this.notifyTrackers("loaded form eventRegister",{none_interactive:!0})})),this.T$.ajaxSetup({timeout:5e4}),this.loadOrgTrackers(),_super.prototype.ready.call(this)},event_register.prototype.main=function(e,o){var n=this,r=this,s=this.mklog("main route"),a=TWF2.Collections,t=e.event_id||this.model.event.id;if(s("Loading event #%d",t),this.model.enteredLegacyPromocode=null,this.model.lastUserInputtedPromocode=null,this.model.hidePromocodeInput="always"===this.settings.hidePromocodeInput,e.event_id&&e.event_id!=this.model.event.id&&this.model.selectedRecurringEvent&&this.model.selectedRecurringEvent.id!=t){s("We have recurring event %d selected, trying to select %d as recurring too",this.model.selectedRecurringEvent.id,t);try{this.selectRecurringEvent(t)}catch(e){this.model.selectedRecurringEvent=null}}var i={event:t};this.settings.locale&&(i.locale=this.settings.locale),this.settings.prefill&&this.settings.prefill.promocodes&&(s("Promocode prefill set: %O",this.settings.prefill.promocodes),i.promocode=this.settings.prefill.promocodes[0],this.model.enteredLegacyPromocode=this.settings.prefill.promocodes[0],this.model.enteredPromocodes=this.settings.prefill.promocodes,"on-prefill"===this.settings.hidePromocodeInput&&(s("Configured to hide promocode input on prefill"),this.model.hidePromocodeInput=!0)),s("Requesting event"),r.getEvent(i,function(){if(s("Got event"),n.obs.fireEvent("trackingWidgetLoaded",{}),n.switchLocale(n.settings.locale||n.model.event.locale),r.model.event.is_recurring){s("Event is recurring");var t=n.model.prefill.recurringEvent;if(!n.model.selectedRecurringEvent&&t){if(s("Trying to select prefilled recurring event #%d",t),a.A.whereSingle(n.model.event.recurring_events,function(e){return e.id==t&&!e.unavaliable}))return n.selectRecurringEvent(t),void n.route("main",{event_id:t});s("Could not find prefilled recurring event")}if(!n.model.selectedRecurringEvent)return s("No recur date selected, rerouting"),n.currentTpl=null,void n.route("select_date");if(!r.model.event.reg_open){s("This recurring event instance is closed, trying to substitute with open one");var i=null;if(r.T$.each(r.model.event.recurring_events,function(e,t){return!!t.unavaliable||(i=t.id,!1)}),i)return void n.route("main",{event_id:i})}}if(!r.model.event.reg_open)return s("Event is closed, rerouting"),n.currentTpl=null,void n.route("tlen");n.checkVKPay()&&(n.model.show_vkpay_button=!0),o(),n.gaTrackVirtualUrl("eventreg_widget/"),n.notifyTrackers("opened form eventRegister",{non_interactive:!e.as_popup&&!n.settings.isInEventListWidget&&!n.model.event.is_recurring}),n.settings.isInEventPage||r.notifyTrackers("view_event",{selective_trackers:["ref"]})})},event_register.prototype.success=function(e,t){if(this.settings.issueTickets&&this.model.order&&this.model.order.has_tickets)return this.model.order.diploma_url=this.model.order.diploma_url+"?utm_campaign=tp_diploma_promo&utm_medium=tpd_widget&utm_source=tp_screen_tickets_ok",void this.route("tickets");t(),this.notifyTrackers("visited page eventRegisterConfirm"),this.gaTrackVirtualUrl("eventreg_widget/success/"),this.model.event.uses_reg_ok_redirect&&document.location.replace(this.model.event.reg_ok_redirect)},event_register.prototype.tickets=function(e,t){var n=this;t(),this.$$(".js-tickets .js-print-ticket").click(function(e){var t=n.mklog("print ticket"),i=+n.T$(e.currentTarget).parents(".js-ticket").data("ticket-id"),o=TWF2.Collections.A.whereSingle(n.model.order.tickets,function(e){return e.id==i}).print_link;t("Printing ticket from url"),n.waitFor(function(e){n.printUrl(o,e)})}),this.model.order.payment?this.notifyTrackers("visited page eventPaymentConfirm",{event_value:this.model.order.payment.sum_org}):this.notifyTrackers("visited page eventRegisterConfirm"),this.gaTrackVirtualUrl("eventreg_widget/tickets/"),this.model.event.uses_reg_ok_redirect&&document.location.replace(this.model.event.reg_ok_redirect)},event_register.prototype.tlen=function(e,t){t()},event_register.prototype.pending=function(e,t){t(),this.gaTrackVirtualUrl("eventreg_widget/pending/")},event_register.prototype.pay=function(e,t){var i=TWF2.Collections.A,o=this.mklog("pay");if(this.model.event.locale_ru=!(!this.model.event.locale||"ru"!=this.model.event.locale),this.model.phone_moscow=this.model.event.phone_moscow,this.model.phone_russia=this.model.event.phone_russia,this.checkVKPay()&&this.model.order.vk_pay_params&&(this.model.show_vkpay_button=!0,this.model.order.payment.cardPaymentActive=!1),this.settings.prefill&&this.settings.prefill.payment){var n=this.settings.prefill.payment;o("Payment type prefilled to %s",n.key);var r=i.whereSingle(this.model.order.payment.paymentMethods.link,function(e){return e.methodKey==n.key});if(r){if(o("Found prefilled payment method, redirecting to %s",r.url),!n.redirect_inside)return this.redirectTo(r.url);this.currentWindowNode.location.replace(r.url)}}t(),this.model.order.payment.cardCloudPaymentActive&&(o("Initializing cloudpay"),this.initPayForm()),this.initializeTimer(),this.notifyTrackers("opened form eventPaymentTypes",{event_value:this.model.order.payment.sum_org}),this.gaTrackVirtualUrl("eventreg_widget/pay/")},event_register.prototype.charity=function(e,t){TWF2.Collections.A;var i=this.mklog("charity");t(),this.model.order.payment.cardPaymentActive&&(i("Initializing cloudpay"),this.initPayForm()),this.gaTrackVirtualUrl("eventreg_widget/charity/")},event_register.prototype.openProcessingPersonalDataModal=function(){var w=this,e=this.T$(window),t=[e.innerWidth(),e.innerHeight()],i=t[0]<=900,o=i?window.innerWidth/window.screen.width:1,n=this.currentWindowNode.covidDataPopap;console.log("");var r=0,s=i?window.innerHeight:t[1]-60;if(this.settings.iframe.useVkScroll&&window.VK){var a=n.vkMaxHeight||s;s=i?a:a-60,r=n.vkScroll+15}if(window.screen&&window.screen.height){var d=(window.screen.height-112)*o;d<s&&(s=d)}var c={height:s},b={width:i?t[0]:t[0]-15,closeCss:{color:"#a8a8a8",top:"3px",right:"9px"},autoShrink:!0,padding:i?4:15,addCss:{"box-sizing":"border-box",border:"0 none",paddingTop:15,paddingRight:i?4:15,maxWidth:i?"none":568,left:i?4:t[0]/2-284},closeConfirm:{texts:{title:"Вернуться к выбору билетов?",description:"Введенные данные не сохранятся",close:this.settings.iframe.useVkScroll&&window.VK?"Вернуться":"Закрыть",proceed:"Нет, продолжить"},routes:null},horizontallyScrolled:i,tintColor:this.settings.popup.tintColor};r&&(b.addCss.top=r),this.context.createIframePopup(c,b,function(e,t,i){var o=w.$$("head").children("link,style").clone(),a=w.T$(t);a.find("head").append(o);var n=[];w.model.separateSelectedTickets.forEach(function(e,t){return n.push({displayNum:t+1,questions:[{tag:"full_name",formname:"covid_forms["+t+"][full_name]",label:"ФИО"},{tag:"birthday",formname:"covid_forms["+t+"][birthday]",label:"Дата рождения в формате «дд.мм.гггг»"},{tag:"doc_type",formname:"covid_forms["+t+"][doc_type]",label:"Тип документа, удостоверяющего личность"},{tag:"doc_number",formname:"covid_forms["+t+"][doc_number]",label:"Серия, номер документа, удостоверяющего личность"}]})}),w.renderTemplate("_closing_confirmation",b.closeConfirm.texts).appendTo(e),w.renderTemplate("_covid_users_anks",{add_ank:n,event_domain:w.model.event.domain,event_id:w.model.event.id,selected_tickets_count:w.model.selectedTickets.count,selected_ticket_price:w.model.selectedTickets.sum}).appendTo(e),a.find("html").css({overflowY:"auto"}),w.renderTemplate("_closing_confirmation",b.closeConfirm.texts).appendTo(e);var r=w.T$(i).parents(".twf-popup-container"),s=r.parents("body").find(".twf-popup-tint"),d=w.T$(s.get(s.length-1)),c=r.find(".twf-popup-close"),l=a.find(".twf-popup-closing-confirmation"),u=l.find(".confirmation-btn__proceed"),h=l.find(".confirmation-btn__close");d.off();var m={},p="×";w.settings.iframe.useVkScroll&&window.VK&&(m={"font-size":"14px"},p="← вернуться");function g(){d.remove(),r.remove()}var f=c.clone().removeClass("twf-popup-close").addClass("pseudoCloseBtn").css(m).text(p).appendTo(e);c.hide();function _(){l.is(":visible")||(f.hide(),l.show()),u.one("click",function(e){l.hide(),f.show(),e.preventDefault()}),h.one("click",function(e){g(),e.preventDefault()})}w.context.appendEscHandler(i,t,_),f.on("click",_);var v=a.find(".js-pro-widget-covid-terms-popup"),k=a.find(".b-pro-wiget__send-covid-data-button"),y=a.find('input[name="accepted_processing_personal_data"]');y.on("change",function(){return w.toggleSubmitButton(y.is(":checked"),k,v)}),a.on("click",".b-pro-wiget__send-covid-data-button",function(e){e.preventDefault();var t=w.prependConsumerHost("event/widget_covid_register/"+w.model.event.id,{subdom:w.model.event.subdomain}),o=a.find("#additional_covid_form"),n=a.find(".b-registration__error"),i=w.reserializeHash(o.serializeArray()),r=w.getText.bind(w);if(w.settings.iframe.useVkScroll&&window.VK&&n.addClass("b-registration__error_vk"),a.find(e.target).hasClass("disabled")&&!y.is(":checked"))return v.removeClass("b-pro-widget__terms-popup_hidden"),!1;var s=w.startWaitingFor(function(){return w.toggleSubmitButton(!0,k,v)});w.T$.post(t,i).done(function(e){s();var t,i=e.result;n.empty().hide(),a.find(".i-question-control").removeClass("b-input-block_status_error"),a.find(".b-error-block").remove(),!i&&e.error&&(i="error"),"error"===i?("validation"==(t=e.error)?w.handleValidationErrors(e,o,n):w.displayErrorOnRegForm(r("Произошла ошибка на стороне сервера: ")+t,n),a.find("html").animate({scrollTop:0},"fast")):"success"===i&&(w.model.event.personal_data_sent=!0,g(),w.$$("#eventreg_form").submit())}).fail(function(e,t,i){"timeout"===t?w.displayErrorOnRegForm(r("Не удалось соединиться с сервером. Пожалуйста, попробуйте еще раз."),n):500<=e.status&&e.status<600?w.displayErrorOnRegForm(r("Произошла ошибка на стороне сервера: ")+e.status+" ("+i+")",n):429==e.status?w.displayErrorOnRegForm(r("Сработала система защиты от спама. Пожалуйста, попробуйте зарегистрироваться еще раз. Если ошибка повторится, обратитесь в службу поддержки по адресу support@timepad.ru."),n):w.displayErrorOnRegForm(r("Произошла неизвестная ошибка коммуникации: ")+i,n),s()})})},null,null,!1)},event_register.prototype.initializeTimer=function(){var o,n,t=this,r=this.mklog("timer"),s=this.$$(".js-timer-clock"),a=this.$$(".js-timer"),i=this.$$(".js-timer-retry-btn");if(s.length){function e(){var e=o-Date.now(),t=Math.floor(e/1e3%60),i=Math.floor(e/1e3/60%60);s.text(("0"+i).slice(-2)+":"+("0"+t).slice(-2)),t<=0&&i<=0&&(r("Countdown reached."),clearInterval(n),a.addClass("js-timer_state-retry"))}function d(){o=Date.now()+12e5,e(),n=setInterval(e,500)}d(),i.click(function(){var e;r("W4 random countdown..."),i.addClass("twf-2-timer__retry-btn_state_loading").addClass("disabled"),setTimeout(t.startWaitingFor(function(){r("Restarting the timer"),a.removeClass("js-timer_state-retry"),i.removeClass("twf-2-timer__retry-btn_state_loading").removeClass("disabled"),d()}),400<(e=1e3*Math.random())?1e3+e:1337)})}else r('Can\'t find timer element with ".js-timer-clock"')},event_register.prototype.prepareCardPayment=function(e){if("cloudpayments"!=e&&"orgcloudpayments"!=e)return null;this.$$('[data-cp="expDateMonthYear"]').val(this.$$("#card-validity-month option:selected").val()+"/"+this.$$("#card-validity-year option:selected").val());var t=this.createCryptogram();return{name:this.$$('[name="name"]').val(),hash:t}},event_register.prototype.initPayForm=function(a){var d=this;a=a||this.model.order.payment,this.settings.cloudPaymentKey=TWF2.Collections.A.whereSingle(a.paymentMethods.card,function(e){return("cloudpayments"==e.methodKey||"orgcloudpayments"==e.methodKey)&&!!e.key.length}).key,this.loadCloudPay();for(var t=this.$$("#card-number"),i=this.$$('[name="name"]'),e=this.$$("#card-validity-year"),o=(new Date).getFullYear(),n=0;n<=15;n++)e.append('<option value="'+(o+n)+'">'+(o+n)+"</option>");t.keyup(function(e){t.val(function(e,t){return function(e){var t,i,o=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,20}/g),n=o&&o[0]||"",r=[];for(t=0,i=n.length;t<i;t+=4)r.push(n.substring(t,t+4));return r.length?r.join(" "):e}(t)})}),i.keyup(function(e){i.val(function(e,t){return t.toUpperCase().replace(/([^\w_\-\ ]|[\d])+/g,"")})}),this.$$("#widget_pay").submit(function(e){e.preventDefault();function t(e){e?i.removeClass("disabled").removeAttr("disabled"):i.addClass("disabled").attr("disabled","disabled")}var i=d.$$(".b-pro-wiget__pay-button").blur();t(!1);var o=d.startWaitingFor(function(){return t(!0)}),n=d.prepareCardPayment(a.cardPaymentCurrent),r=d;if(n&&n.hash){var s={crossDomain:!0,dataType:"jsonp",url:d.prependConsumerHost("/partners/payment_begin/"+a.cardPaymentCurrent+"/"+a.id+"/",{subdom:d.model.event.subdomain}),data:n,type:"POST"};d.T$.ajax(s).done(function(e){o(),"process"===e.status?d.redirectTo(e.url):"success"===e.status?(r.model.order=e.order,d.route(d.settings.issueTickets?"tickets":"success")):"error"===e.status&&e.error?d.showPayErrors({process:e.error}):"error"===e.status&&d.showPayErrors({process:"Не удалось обработать платёж"})})}else o();return!1})},event_register.prototype.select_date=function(e,t){var s=this,i="select_date",o=TWF2.Collections;if("vertical-days"===this.settings.recurringDatesMode&&(i="select_date_vertical"),t(i),"vertical-days"===this.settings.recurringDatesMode){var n=this.mklog("GridScroller");if(!o.A.arrayCount(this.model.event.recurring_events,function(e){return!e.unavaliable}))return n("No dates, rerouting"),this.currentTpl=null,void this.route("tlen");n("Initializing");var r,a=this.$$(".js-gridscroller"),d=a.find(".js-gridscroller__container"),c=a.find(".js-gridscroller__inner-container"),l=a.find(".js-gridscroller__left"),u=a.find(".js-gridscroller__right"),h=a.find(".js-gridscroller__mover"),m=a.find(".js-gridscroller__cell"),p=m.width(),g=a.find(".js-gridscroller__header").length,f=g*p,_=a.data("disabled-class"),v=this.$$(".js-tooltip");n("Cell width determined as %d",p),n("Mover width determined as %d * %d = %d",g,p,f),h.css("position","relative"),r=h.height(),h.css("position","absolute"),n("Mover height determined as %d",r);function k(){if(!s.$$(".js-gridscroller").length)return n("Lost scroller element, self-destructing watcher interval"),void window.clearInterval(y);(b=d.width())!=w&&(n("Container width changed %d -> %d, resetting width limiter",w,b),T=Math.floor(b/p)*p,n("Inner cont width := %d",T),c.css({width:T,height:r}),d.css({height:r}),S(0),n("Page count = %d",$())),w=b}var y,w=0,b=0,T=0,$=function(){return Math.ceil(f/T)},C=0,S=function(e){n("Setting page %d",e),e=Math.max(0,e),e=Math.min($()-1,e),n("Pageno after normalization = %d",e),C=e,h.css({left:-e*T}),F()},F=function(){C?(n("We are NOT on zero page, enabling <"),l.removeClass(_)):(n("We are on zero page, disabling <"),l.addClass(_)),C>=$()-1?(n("We are on last page, disabling >"),u.addClass(_)):(n("We are NOT on last page, enabling >"),u.removeClass(_))};k(),y=window.setInterval(k,1e3),l.click(function(){return S(C-1)}),u.click(function(){return S(C+1)});var P=l.height(),W=r/2-P/2;n("Mover height = %d, button height = %d, button top := %d",r,P,W),l.css("top",W),u.css("top",W),m.mouseenter(function(e){var t=s.T$(e.currentTarget),i=s.T$(e.currentTarget).find(".js-date-choice"),o=i.data("event-tickets-left"),n=i.data("event-tickers-reglimit");if(!!o){var r=t.offset();v.find(".js-tooltip-tickets-left").text(o+" из "+n),r.top-=v.height(),r.left+=t.width()/2-v.width()/2,v.offset(r).fadeTo(0,1)}}).mouseleave(function(){v.fadeTo(0,0)})}this.gaTrackVirtualUrl("eventreg_widget/select_date/")},event_register.prototype.button=function(e,o){var n=this,t={response_type:"jsonp",event:this.model.event.id};this.settings.locale&&(t.locale=this.settings.locale),this.loadEventModel(t,function(){var e=n.settings.buttonSettings.text,t=n.settings.mainFormButtonSettings.texts;e=e||(n.model.event.min_price?t.buy_ticket:t.register),o(),n.obs.fireEvent("trackingWidgetLoaded",{});var i=n.$$("button.open_widget").css(n.settings.buttonSettings.css).text(e);(!n.model.event.reg_open&&!n.model.event.is_recurring||n.model.event.is_recurring&&!TWF2.Collections.A.whereSingle(n.model.event.recurring_events,function(e){return!e.unavaliable}))&&i.addClass("disabled")}),this.settings.noScrollToWidgetOnViewChange=!0,this.gaTrackVirtualUrl("eventreg_widget/button/")},event_register.prototype.widget_error=function(e,t){var i="unknown",o=this.context.placeholderURL;e&&e.type&&(i=e.type),this.model.error={unknown:{support:!0,fallback:!0,header:"Неизвестная ошибка",message:"К сожалению, виджету заказа билетов почему-то не удалось загрузиться."},404:{support:!1,fallback:!1,header:"404: Событие не найдено",message:"События для этого виджета не существует. Возможно, оно было удалено."},403:{support:!1,fallback:!1,header:"403: Доступ ограничен",message:"Доступ к запрошенному событию ограничен."},400:{support:!0,fallback:!0,header:"Конфигурация виджета повреждена",message:"Кажется, виджет заказа билетов был установлен неправильно."}}[i],!o&&this.model.event.id&&(o=this.model.widgetInfo.host+"event/"+this.model.event.id),this.model.error.fallback_url=o,t()},event_register.prototype.resetEventModel=function(){var i=this,e=this.mklog("main route"),t=TWF2.Collections;e("Resetting model, states, flags, selectedSeats of seatcheck"),t.H.each(this.flags,function(e,t){return i.flags[t]=!1}),this.model.selectedTickets=null,this.model.selectedTicketByCat=null,this.currentWindowNode.seatcheck&&this.currentWindowNode.seatcheck.i.clearSeatsSelection(),this.model.attendees=[],this.model.policyResult=null,this.model.enteredPromocodes=[],this.model.event=null,this.settings.prefill&&this.settings.prefill.promocodes&&(e("Promocode prefill set (reprefill on reset): %O",this.settings.prefill.promocodes),this.model.enteredLegacyPromocode=this.settings.prefill.promocodes[0],this.model.enteredPromocodes=this.settings.prefill.promocodes)},event_register.prototype.handleToggleImageHeader=function(e){e.preventDefault(),this.T$(e.currentTarget).toggle(),this.$$(".b-payment__event-more").toggleClass("b-payment__event-more_open")},event_register.prototype.handleOpenWidgetInPopup=function(e){var i=this;e.preventDefault(),this.openSwitchToIframePopup({autoHeight:!0,background:"white"},this.settings.popup,function(e,t){i.currentTpl=null,i.route("main",{as_popup:!0}),i.loadCloseConfirm(t)},function(){i.currentTpl=null,i.route("button")})},event_register.prototype.handleAddAttendeeForm=function(e){if(e.preventDefault(),!this.T$(e.currentTarget).hasClass("disabled")){var t,i=parseInt(this.$$(".add-attendee-re select").val()),o=TWF2.Collections.A.whereSingle(this.model.event.tickets,function(e){return e.id==i}),n=TWF2.Collections.A.arrayCount(this.model.attendees,function(e){return e.reId==i});!i||n>=o.max||(t=this.addAttendeeForm(i),this.scrollToElement(t))}},event_register.prototype.handleReportFillForm=function(){this.flags.reportedFillFormEvent||(this.flags.reportedFillFormEvent=!0)},event_register.prototype.handleRedirectingA=function(e){e.preventDefault(),this.context.topmostWindow.location=TWF2.T$(e.currentTarget).attr("href")},event_register.prototype.handleSelectEventDate=function(e){this.currentWindowNode.seatcheck&&(this.currentWindowNode.seatcheck.i.clearSeatsSelection(),this.updatePlacesList(),this.recountSelectedPlaces());var t=+this.T$(e.currentTarget).data("event-id"),i=this.mklog("[Recurring]");if(t){i("Requested different date: %d",t);try{this.selectRecurringEvent(t)}catch(e){return void i(e)}this.route("main",{event_id:t})}else i("no date selected")},event_register.prototype.selectRecurringEvent=function(t){var e;if(!(e=TWF2.Collections.A.whereSingle(this.model.event.recurring_events,function(e){return e.id==t}))||e.unavaliable)throw"rce can not be accessed";this.model.selectedRecurringEvent=e},event_register.prototype.handleOpenSelectEventDate=function(e){e.preventDefault(),this.route("select_date")},event_register.prototype.askPromocode=function(e){e&&e.preventDefault(),this.$$(".promocode_link").remove(),this.$$(".promocode_form").show()},event_register.prototype.handleApplyPromocode=function(e){var t=this;e&&e.preventDefault();var i,o=this.$$("#promoCode"),n=this.$$("#promocodeInput"),r=(o.find(".b-input-block__promo-btn-text"),this.mklog("promocode-handler")),s=n.val();this.getText.bind(this);if(s&&s.length){if(this.model.lastUserInputtedPromocode=s,r("User-inputted promocode"),i=this.applyPromocode(n.val()),this.model.event.policy_features.promocode){function a(e){return function(){t.model.event.promocode_ok=e,t.model.event.promocode_wrong=!e}}i.done(a(!0)).fail(a(!1)).always(function(){t.repaintSection("promocodeBlock")})}}else r("Empty promocode, aborting")},event_register.prototype.handlePromocodeNote=function(){void 0===this.model.ifYouHavePromocode&&(this.model.ifYouHavePromocode=!this.model.event.promocode_locked)},event_register.prototype.applyPromocode=function(e){var t=this,i=TWF2.Collections.A;if(this.model.event.policy_features.promocode){var o=e.split(/[\s,;]+/);return i.each(o,function(e,t){return o[t]=e.trim()}),this.applyPromocodes(i.where(o,function(e){return""!==e}))}var n=this.T$.Deferred(),r=TWF2.microguid(4);return this.elog("promocode","Classic mode",r),this.model.enteredLegacyPromocode=this.model.formData.promocode=e,this.reloadEvent(function(){t.repaint(),n.resolve()}),n},event_register.prototype.applyPromocodes=function(e){var t,i=this,o=TWF2.Collections.A,n=this.T$.Deferred(),r=TWF2.microguid(4),s=this.model.enteredPromocodes.length;return this.elog("promocode","Policy mode",r),this.elog("promocode","Already %s promocodes entered",r,s),o.each(e,function(e){e+="",i.elog("promocode","Applying promocode %s",r,e),i.model.enteredPromocodes.push(e)}),this.model.enteredPromocodes=o.where(this.model.enteredPromocodes,function(e,t){return-1==t.indexOf(e)}),t=this.model.enteredPromocodes.length,this.elog("promocode","Now %s promocodes entered (was %s)",r,t,s),t===s?n.reject():(this.model.formData.promocodes=this.model.enteredPromocodes,this.elog("promocode","Recounting stuff",r),this.recountSelectedTickets().done(function(){o.containsAll(i.model.policyResult.applied_promocodes,e,function(e,t){return e.toLowerCase()==t.toLowerCase()})?(i.elog("promocode","GOOD Promocode is included in applied promocodes list",r),n.resolve()):(i.elog("promocode","BAD Promocode is missing from applied promocodes list",r),n.reject())})),n},event_register.prototype.checkPayForm=function(){function e(){return parseInt(n.val())<(new Date).getFullYear()}function t(){var e=parseInt(r.val());return parseInt(n.val())==(new Date).getFullYear()&&e<+(new Date).getMonth()+1}function i(){return!!o.$$('#widget_pay [name="name"]').val().match(/([^\w_\-\ ]|[\d])+/)}var o=this,n=this.$$("#card-validity-year"),r=this.$$("#card-validity-month"),s={};return!!(t()||e()||i())&&(t()&&(s.expDateMonth="Некорректное значение месяца"),e()&&(s.expDateYear="Некорректное значение года"),i()&&(s.name="В имени владельца карты допущены ошибки"),s)},event_register.prototype.createCryptogram=function(){if(!window.checkout)return null;function i(){return window.checkout.accessorMap}function e(){t.each(i(),function(e,t){return t&&(i()[t]=n[t])})}var t=TWF2.Collections.H,o=this.checkPayForm(),n=(this.$$("#pay_errors"),{});t.each(i(),function(e,t){return t&&(n[t]=e)});var r=window.checkout.createCryptogramPacket();if(r.success&&o)e(),this.showPayErrors(o);else{if(r.success)return r.packet;r&&r.messages?(r.messages=TWF2.extend(r.messages,o),r.messages&&r.messages.expDateMonth&&(r.messages.expDateMonth="Некорректное значение месяца"),r.messages&&r.messages.expDateYear&&(r.messages.expDateYear="Некорректное значение года"),r.messages&&r.messages.name&&(r.messages.name="В имени владельца карты допущены ошибки"),e(),this.showPayErrors(r.messages)):o&&(e(),this.showPayErrors(o))}return null},event_register.prototype.showPayErrors=function(e){var o=this,i=TWF2.Collections.H,n=this.$$("#pay_errors"),r=this.getText.bind(this),s={expDate:["#card-validity-month","#card-validity-year"],expDateYear:["#card-validity-year"],expDateMonth:["#card-validity-month"],name:['#widget_pay [name="name"]'],cardNumber:["#card-number"],cvv:["#card-cvc"]};n.empty(),i.each(s,function(e,t){for(var i in e)o.$$(e[i]).removeClass("payform-error")}),i.each(e,function(e,t){n.append("<li>"+r(e)+"</li>"),s[t]&&i.each(s[t],function(e){o.$$(e).addClass("payform-error")}),n.is(":visible")||n.show()})},event_register.prototype.applyCloudPay=function(){window.cp&&(window.checkout=new cp.Checkout(this.settings.cloudPaymentKey,this.$$("#widget_pay").get(0)),this.log("[CloudPay] apply widgets"))},event_register.prototype.applyUploadcare=function(){window.uploadcare&&(this.log("[Uploadcare] apply widgets"),this.$$("#eventreg_form input[role='uploadcare-uploader-outer']").TWFiter(function(e){return window.uploadcare.Widget(e)}))},event_register.prototype.loadCloudPay=function(){function e(){t.log("[CloudPay] library ready"),t.applyCloudPay()}var t=this,i=["https://widget.cloudpayments.ru/bundles/checkout"];this.appendJS(i),window.cloudPay?e():(this.log("[CloudPay] loading library"),this.context.loader.includeJS(i,e))},event_register.prototype.loadUploadcare=function(){function e(){i.log("[Uploadcare] library ready"),i.applyUploadcare()}function t(e,t){window[e]=t,i.currentWindowNode[e]=t}var i=this,o=["https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"];t("UPLOADCARE_LIVE",!1),t("UPLOADCARE_LOCALE",this.locale),t("UPLOADCARE_PUBLIC_KEY",this.model.event.uc_publickey),this.appendJS(o),window.uploadcare?e():(this.log("[Uploadcare] loading library"),this.context.loader.includeJS(o,e))},event_register.prototype.loadTPPhone=function(){return this.T$.Deferred().resolve()},event_register.prototype.attachDadata=function(){var c=this,l=this.mklog("Dadata attach");this.loadDadata().done(function(){c.$$(".b-reg-row.js-dadata").TWFiter(function(e){l("Attaching to %O",e),e.removeClass(".js-dadata");var t=e.data("tag"),i=TWF2.Collections.A.whereSingle(c.model.event.questions,function(e){return e.tag===t}),o=e.find("input");if(i){l("Matching question: %s - %O",t,i);var n=i.meta.dadata,r={token:c.settings.dada_config.api_key,addon:"spinner"};"org"===n.preset?(TWF2.T$.extend(r,{token:c.settings.dada_config.api_key,type:"PARTY",count:4,scrollOnFocus:!1}),n.prefill_org&&(r.onSelect=function(e){c.settings.prefill.aux.inn=e.data.inn,c.settings.prefill.aux.kpp=e.data.kpp,c.settings.prefill.aux.address=e.data.address?e.data.address.value:null,c.settings.prefill.aux.short_with_opf=e.data.name?e.data.name.short_with_opf:null})):"city"===n.preset&&TWF2.T$.extend(r,{type:"ADDRESS",bounds:"city",constraints:{label:"",locations:{city_type_full:"город"}},hint:!1,count:4,scrollOnFocus:!1,formatSelected:function(e){return e.data.city},formatResult:function(e,t,i){return i.data.city}}),n.fill_key&&(r.formatSelected=function(e){return e.data[n.fill_key]}),n.settings&&TWF2.T$.extend(r,n.settings);var s={$reg_row:e,q:i,ddc:n,dadata_settings:r};c.obs.fireEvent("preDadataAttach",s),o.suggestions(r),c.obs.fireEvent("postDadataAttach",s);var a=o.suggestions();if(a&&(a.$viewport=TWF2.T$(c.currentWindowNode),"city"===n.preset&&n.geolocation)){l("Geolocation enabled, attempting!");var d=a.getGeoLocation();d&&d.done(function(e){l("Got geoloc %O",e),e&&e.city&&o.suggestions().setSuggestion({value:e.city,data:e})})}}else l("ERROR no matching question for %s",t)})})},event_register.prototype.loadDadata=function(){var e=this,t=this.mklog("Dadata"),i=this.currentWindowNode,o=new TWF2.MassLoader,n=this.T$.Deferred();return this.T$.fn.suggestions?(t("Dadata js already present"),n.resolve()):(t("Loading dadata suggestions"),i.jQuery=this.T$,i.$=this.T$,i.TimepadWF=TWF2,this.appendJS(["https://cdn.jsdelivr.net/npm/suggestions-jquery@17.12.0/dist/js/jquery.suggestions.min.js"],o.addEvent("suggestions-js")),o.wait(function(){t("Dadata ready!"),e.obs.fireEvent("dadataReady",{}),n.resolve()}),n)},event_register.prototype.loadSeatcheck=function(){var e,t=this,i=this.currentWindowNode,o=[],n=this.mklog("Seatcheck");n("loading library"),this.appendCSS([this.prependConsumerHost("css/seatcheck.css")]),e=[this.prependConsumerHost("js/seatcheck.js"),this.prependConsumerHost("js/svoge.js")],o.push(this.prependConsumerHost("js/lib/jquery/1.9.1/jquery.min.js"),this.prependConsumerHost("js/lib/d3/3.4.9/d3.min.js"),this.prependConsumerHost("js/lib/detectmobilebrowser/0.0.1/detectmobilebrowser.min.js")),this.model.selectedSeatedTickets=[],this.appendJS(o,function(){t.appendJS(e,function(){n("overriding handlers"),i.seatcheck.i.updateTicketsAlertBlock=t.handleSeatcheckUpdate.bind(t),i.tpgettext=t.getText.bind(t),i.svoge=new i.Svoge(t.getSvogeConfig()),t.obs.fireEvent("seatcheckReady",{seatcheck:i.seatcheck})},!0)})},event_register.prototype.handleSeatcheckUpdate=function(t,e){var i=this.mklog("Seatcheck"),o=TWF2.Collections.A,n=o.whereSingle(this.model.event.seatedTickets,function(e){return e.id==+t.catId}),r={cat:n,place:t};if(i("Processing seatcheck change"),this.setFormSelectedTickets(null,["checkbox"]),this.model.event.uses_multiank)if(e)this.model.selectedSeatedTickets.push(r),this.flags.multiankSelectsReplaced&&(i("Multiank - adding new form"),o.whereSingle(this.model.attendees,function(e){return e.isSeated&&e.seatedInfo.place.id==r.place.id})||this.addAttendeeForm(+n.id,{seatcheck:r}));else if(o.removeWhere(this.model.selectedSeatedTickets,function(e){return e.place.id==r.place.id}),this.flags.multiankSelectsReplaced){i("Multiank - REMOVING form");var s=o.whereSingle(this.model.attendees,function(e){return e.isSeated&&e.seatedInfo.place.id==r.place.id});s&&this.removeAttendee(s)}this.recountSelectedTickets(),this.recountSelectedPlaces(),this.updatePlacesList()},event_register.prototype.removePlaceFromList=function(e){var t=e.target,i=this.T$(t).parents(".b-reg-table__row").attr("id").match(/seat_cont_(\d+)/),o=i&&+i[1];o&&this.currentWindowNode.seatcheck.i.removeSeatSelectionById(o,!1)},event_register.prototype.updatePlacesList=function(){var i=this,o=TWF2.Collections.A,n=this.$$("#places_list"),e=n.parents(".b-registration__section"),t=this.currentWindowNode.seatcheck.i.getSelectedData();n.children().remove(),t.length?(t.forEach(function(t){var e={cat:o.whereSingle(i.model.event.seatedTickets,function(e){return e.id==+t.catId}),place:t};e.placeHuman=i.getHumanPlace(e.place.d),i.renderTemplate("_seat_info",e).appendTo(n)}),e.show()):e.hide()},event_register.prototype.loadSeatcheckData=function(e,t){var i=this;void 0===e&&(e={});var o=this.currentWindowNode,n=(this.getText.bind(this),TWF2.cascade({promocode:this.model.enteredLegacyPromocode,locale:this.locale},e)),r={crossDomain:!0,dataType:"jsonp",url:this.prependConsumerHost("/event/get_seats/"+this.model.event.id+"/jsonp/",{subdom:this.model.event.subdomain}),data:n,method:"GET"};this.log("[Seatcheck] loading seats"),this.T$.ajax(r).done(t||function(e){i.log("[Seatcheck] rendering"),i.$$(".schk-loader").detach(),i.$$(".js-schk-wrap__cover-btn-wrap").show(),o.seatcheckIsMobilePlatform&&i.$$(".js-schk-wrap_preview").addClass("schk-wrap_mobile-preview"),o.seatcheck.setData(e).setElement(i.$$(".schk-wrap").get(0)).appendOptions({eventregForm:i.$$("#eventreg_form").get(0),event:{multireg:i.model.event.uses_multireg},seats:{maxRescale:5}}).draw(),i.model.attendees.length||i.model.event.uses_multiank||i.addAttendeeForm(),i.model.event.seatedTickets=o.seatcheck.data.cats||[],i.recountSelectedTickets()})},event_register.prototype.initializePreloader=function(){var t=this,e={crossDomain:!0,dataType:"jsonp",url:this.prependConsumerHost("/event/get_preloader/"+this.model.event.id,{subdom:this.model.event.subdomain}),method:"GET"};this.T$.ajax(e).done(function(e){t.currentWindowNode.seatcheck.p.setElement(t.$$(".schk-wrap").get(0)).setData(e).setActiveSectors(t.model.event.active_sectors).setLayers().draw().createTooltip().makeInteractive(t.openSeatcheckModal.bind(t)),t.$$(".schk-loader").hide(),t.model.attendees.length||t.model.event.uses_multiank||t.addAttendeeForm(),t.model.event.seatedTickets=[],t.recountSelectedTickets()})},event_register.prototype.openSeatcheckModal=function(p){var g=this,e=this.currentWindowNode.seatcheck,f=this.model.event.uses_preloader;if(e.opening)this.log("[Seatcheck] trying to open modal twice");else{e.opening=!0;var t=this.currentWindowNode.seatcheckIsMobilePlatform,i=this.T$(window),o=[i.innerWidth(),i.innerHeight()],_=t?window.innerWidth/window.screen.width:1,n=0,w=t||o[0]<=900,v=w?window.innerHeight:o[1]-60;if(this.settings.iframe.useVkScroll&&window.VK){var r=e.vkMaxHeight||v;v=t?r:r-60,n=e.vkScroll+15}if(window.screen&&window.screen.height){var s=(window.screen.height-112)*_;s<v&&(v=s)}var k,y,a={height:v},d={width:w?o[0]:o[0]-15,closeCss:{color:"#a8a8a8",top:"27px",right:"27px"},autoShrink:!0,padding:w?0:15,additionalClose:".js-proceed-btn",noClose:w,addCss:{"box-sizing":"border-box",border:"0 none"},horizontallyScrolled:w,tintColor:this.settings.popup.tintColor};n&&(d.addCss.top=n),this.context.createIframePopup(a,d,function(t,i,o){var e=g.$$("head").children("link,style").clone(),n=g.currentWindowNode.svoge.element.clone(),s=g.T$(i),r=g.currentWindowNode.seatcheck;s.find("head").append(e),s.find("body").append(n);var a=g.renderTemplate("_seatcheck_modal",g.model),d=a.find(".schk-loader_full"),c=d.find(".schk-loader__text");w&&a.addClass("schk-modal_mobile"),k=g.$$(".schk-fixator"),y=g.$$(".schk-wrap"),f||(k.css("height",v),y.detach(),y.addClass("schk-wrap_stretched"),y.removeClass("schk-wrap_bounded"),a.find(".schk-scheme__scheme").append(y)),g.T$(t).append(a.css({height:g.T$(o).height()/_,width:g.T$(o).width()/_}));function l(){r.scale.outer=_;var e=g.T$.Deferred();if(r.createLegend(a[0],e,w),w){var v=!1,k=0,y=0;s.on("touchstart",".schk-modal__legend",function(e){v=!0;var t=e.originalEvent.touches[0];y=t.pageX,k=$(e.currentTarget).position().left}).on("touchend",".schk-modal__legend",function(){v=!1}).on("touchmove",".schk-modal__legend",function(e){if(v){var t=e.originalEvent.touches[0].pageX,i=k+-(y-t),o=$(e.currentTarget).closest(".schk-modal__legend-wrap-mobile"),n=o.innerWidth()-$(e.currentTarget).innerWidth(),r=o.find(".schk-modal__arrow_left"),s=o.find(".schk-modal__arrow_right"),a=o.closest(".schk-modal__legend-wrap").find(".schk-modal__advancer-arrow_left"),d=o.closest(".schk-modal__legend-wrap").find(".schk-modal__advancer-arrow_right");if(n<0){n<=i&&i<=0&&$(e.currentTarget).css({left:i}),0<i&&(r.hide(),$(e.currentTarget).css({left:0})),i<n&&(s.hide(),$(e.currentTarget).css({left:n}));var c=(l=$(e.currentTarget),h=(u=o).position(),m=Math.floor(u.position().left+u.outerWidth()),p=Math.floor(h.left),g=l.position(),f=Math.floor(l.position().left+l.outerWidth()),(_=Math.floor(g.left))<p&&m<f?"both":_<p?"left":m<f?"right":"none");"both"==c?(r.show(),s.show(),a.show(),d.show()):"left"==c?(r.show(),s.hide(),a.show(),d.hide()):"right"==c&&(r.hide(),s.show(),a.hide(),d.show())}}var l,u,h,m,p,g,f,_}).on("click",".schk-modal__advancer-arrow_right",function(e){var t=$(e.currentTarget).parents(".schk-modal__legend-wrap"),i=t.find(".schk-modal__legend-wrap-mobile"),o=i.innerWidth(),n=t.find(".schk-modal__legend"),r=t.find(".schk-modal__legend").children(".legend__cat"),s=0,a=Math.floor(i.innerWidth()/2),d=i.find(".schk-modal__arrow_left"),c=i.find(".schk-modal__arrow_right"),l=t.find(".schk-modal__advancer-arrow_left");g.T$.each(r,function(e,t){s+=$(t).outerWidth(!0)});var u=n.position().left+s;u-o<1.2*a&&(a=u-o,$(e.currentTarget).hide(),c.hide()),l.is(":hidden")&&(l.show(),d.show());var h=n.position().left-a;n.animate({left:h},150)}).on("click touchend",".schk-modal__advancer-arrow_left",function(e){var t=$(e.currentTarget).parents(".schk-modal__legend-wrap"),i=t.find(".schk-modal__legend-wrap-mobile"),o=t.find(".schk-modal__legend"),n=Math.floor(i.innerWidth()/2),r=o.position().left+n,s=t.find(".schk-modal__advancer-arrow_right"),a=i.find(".schk-modal__arrow_left"),d=i.find(".schk-modal__arrow_right");s.is(":hidden")&&(s.show(),d.show()),Math.abs(o.position().left)<1.2*n&&(r=0,$(e.currentTarget).hide(),a.hide()),o.animate({left:r},150)})}e.done(function(){r.options.panels.right=36,r.drawer.rescaleSeats(!0),a.css({transform:"scale("+_+")","transform-origin":"0 0"}),s.on("click touchend",".js-schk-zoom-in",function(){return r.actions.zoom.methods.zoom(1.5)}),s.on("click touchend",".js-schk-zoom-out",function(){return r.actions.zoom.methods.zoom(1/1.5)}),r.actions.pan.methods.enable(),f&&(g.model.attendees.length||g.model.event.uses_multiank||g.addAttendeeForm(),g.model.event.seatedTickets=r.data.cats||[]),g.recountSelectedTickets().done(function(){var e=s.find(".schk-modal__legend-wrap-mobile").outerWidth(!0),t=s.find(".schk-modal__legend").outerWidth(),i=s.find(".schk-modal__legend").children(".legend__cat"),o=navigator.userAgent.toLowerCase(),n=o.indexOf("chrome")<0&&0<o.indexOf("safari")&&o.substr(o.indexOf("version/")+"version/".length,3);if(n&&n<10){var r=0;g.T$.each(i,function(e,t){r+=$(t).outerWidth(!0)}),t=r}e-t<0&&(s.find(".schk-modal__advancer-arrow_right").show(),s.find(".schk-modal__arrow_right").show())}),g.recountSelectedPlaces(),g.obs.fireEvent("seatcheckLegendCreated",{renderTarget:t,iframeDocumentNode:i,iframe:o})})}if(f){var u=g.T$(o).parents(".twf-popup-container"),h=u.css("background-color");u.css("background-color","#f2f2f2");var m={filter:{d:{sector:p}}};d.css("padding-top",g.T$(o).height()/2-c.innerHeight()/2),g.loadSeatcheckData(m,function(e){d.remove(),u.css("background-color",h),r.setData(e).setElement(a.find(".schk-wrap").get(0)).appendOptions({eventregForm:g.$$("#eventreg_form").get(0),seats:{maxRescale:5}}).draw(),l(),r.i.restoreSelectedSeats()})}else l()},null,function(){var e=g.currentWindowNode.seatcheck;f||(e.actions.pan.methods.disable(),y.removeClass("schk-wrap_stretched"),y.addClass("schk-wrap_bounded"),k.removeAttr("style"),k.prepend(y),e.options.panels.right=0,e.drawer.rescaleSeats(!1)),e.tooltip.hideTooltip(!0),t||y.attr("tabindex","1").focus().blur().removeAttr("tabindex"),e.opening=!1})}},event_register.prototype.addAttendeeFormHandlers=function(e,t){var i=this,o=e.find(".js-section-re_selector, select.change-attendee-re");e.find(".remove-attendee").click(function(e){e.preventDefault(),i.removeAttendee(t)}),o.val(t.reId).change(function(e){t.reId=parseInt(o.val()),i.updateAttendeeCounts()}),this.model.event.uses_phone&&this.loadTPPhone().done(function(){return e.find("[data-type=phone] input").tpphone()}),this.model.event.uses_file_upload&&this.applyUploadcare()},event_register.prototype.prefillQuestions=function(o,e){var t=TWF2.Collections.H.each,n=TWF2.Collections.A.whereSingle;t(e,function(e,t){var i=n(o,function(e){return e.id==t||e.tag===t});i&&(i.value=e)})},event_register.prototype.addAttendeeForm=function(e,t){var i=this;void 0===t&&(t={});var o,n=this.addAttendee(e,t),r=(o=n,i.renderTemplate("_attendee_form",TWF2.cascade({},i.model,o)));return r.appendTo(this.$$(".b-attendees")),this.log("[FORM-view] added attendee form for re#"+e),this.addAttendeeFormHandlers(r,n),r.data("attendee",n),n.$block=r,this.model.event.uses_multiank&&this.updateAttendeeCounts(),this.obs.fireEvent("attendeeFormAdded",{reId:e,attendee:n,$form:r}),r},event_register.prototype.removeAttendee=function(e){var s=this;if(e.deletable){this.model.attendees.splice(e.num,1),e.$block&&e.$block.remove(),e.isSeated&&this.currentWindowNode.seatcheck.i.removeSeatSelectionByDatum(e.seatedInfo.place,!1);var a=0;this.T$.each(this.model.attendees,function(e,t){var i=s.$$(".b-attendees").find(".b-attendee-"+t.num),o=new RegExp("user_forms\\[\\d+\\]"),n=new RegExp("\\d+"),r=a+1;i.find("input,select,textarea").TWFiter(function(e){return e.attr("name",function(e,t){return t&&t.replace(o,"user_forms["+a+"]")})}),i.find(".b-registration__question-number").TWFiter(function(e){return e.text(function(e,t){return t.replace(n,r.toString())})}),i.removeClass("b-attendee-"+t.num).addClass("b-attendee-"+a),s.log("[attendee] renumerated "+t.num+" => "+a),t.num=a,t.displayNum=r,a++}),this.updateAttendeeCounts()}},event_register.prototype.addAttendeeForms=function(e){var i=this;e.preventDefault();var o,n=TWF2.Collections,r=this.mklog("addAttendeeForms");r("Mass adding forms for all selected tickets"),n.A.each(this.model.selectedTicketByCat,function(e,t){if(r("Adding %d tickets of cat %d",e,t),i.model.event.uses_places&&!n.A.whereSingle(i.model.event.tickets,function(e){return e.id==t}))r("Cat %d has PLACES, special treatment!",t),n.A.each(i.model.selectedSeatedTickets,function(e){return e.cat.id==t&&i.addAttendeeForm(+e.cat.id,{seatcheck:e})});else for(o=0;o<e;o++)i.addAttendeeForm(t)})},event_register.prototype.displayErrorOnRegForm=function(e,t){void 0===t&&(t=this.$$(".b-registration__error")),t.show().append(this.T$("<p>"+e+"</p>")),this.scrollToElement(t)},event_register.prototype.handleValidationErrors=function(o,n,r){var s=this,a=this,e=TWF2.Collections.H,d=TWF2.Collections.A,c=this.getText.bind(this),l=!0;e.each(o.validation_errors,function(e,t){if("+"===t||t.match(/user_forms\[\d+]\[\+]/i))d.each(e,function(e){return s.displayErrorOnRegForm(e)});else{l=l&&(o.hasBannedEmail?s.displayErrorOnRegForm(c("В связи с жалобой организатора для вас заблокирован доступ к данному мероприятию на основании пункта 4.3 <a href='http://timepad.ru/upload/docs/TimePad_terms.pdf' target='_blank'>Правил пользования сайтом</a>. Причину блокировки вы можете узнать у организатора через форму обратной связи.")):s.displayErrorOnRegForm(c("Пожалуйста, проверьте правильность заполнения полей, выделенных красным."),r),!1);var i=null;i=n?n.find("div[data-formname='"+t+"']"):a.$$("div[data-formname='"+t+"']"),s.T$.isArray(e)&&(e=e.join(". ")),i.find(".i-question-control").length?i.find(".i-question-control").addClass("b-input-block_status_error").append(a.renderTemplate("_errorBlock",{errorText:e})):i.addClass("error").append(TWF2.T$('<p class="text-error">'+e+"</p>"))}})},event_register.prototype.prepareRegistrationRequest=function(){function i(e,t,i){o.model.formData[e+"["+t+"]"]=i}var o=this,e=o.T$,t=o.$$("#eventreg_form"),n=TWF2.Collections.H,r=TWF2.Collections.A;if(this.mklog("eventRegister:request")("Building request"),o.model.formData=o.reserializeHash(t.serializeArray()),e.extend(o.model.formData,this.settings.addFormData),o.model.formData.tickets=this.model.separateSelectedTickets,o.model.formData.locale=this.locale,o.model.formData.ga_cid=this.model.ga_cid,this.settings.prefill.aux.use_ticket_remind=this.settings.use_ticket_remind?1:0,window.roistat&&this.settings.send_roistat&&window.roistat.visit&&i("aux","roistat_visit",window.roistat.visit),this.settings.prefill&&this.settings.prefill.aux&&(n.each(this.settings.prefill.aux,function(e,t){return i("aux",t,e)}),"magick-search"==this.settings.prefill.aux.from)){function s(e){return e&&e.indexOf&&e.indexOf("@")<0&&(e+="@phone.timepad.ru"),e}var a=new RegExp("user_forms\\[\\d+\\]\\[mail\\]");n.each(n.where(o.model.formData,function(e,t){return t.match&&!!t.match(a)}),function(e,t){return o.model.formData[t]=s(e)}),o.model.formData.order_mail=s(o.model.formData.order_mail)}if(r.each(this.model.enteredPromocodes,function(e,t){return i("promocodes",t,e)}),this.model.enteredLegacyPromocode&&(this.model.formData.promocode=this.model.enteredLegacyPromocode),this.settings.forwardReferer){var d=document.referrer,c=!1;c="auto"===this.settings.forwardZeroReferer?this.settings.isInEventPage:!!this.settings.forwardZeroReferer,(d||c)&&(o.model.formData.referer=document.referrer)}this.settings.utmForward&&n.each(this.getUtms(),function(e,t){return o.model.formData[t]=e}),this.settings.forwardCookies&&n.each(this.getCookies(),function(e,t){return i("cookies",t,e)}),this.settings.prefill.utm&&n.each(this.settings.prefill.utm,function(e,t){return o.model.formData[t]=e}),this.model.partner&&(o.model.formData.r_p=this.model.partner),this.model.event.uses_processing_personal_data&&(this.model.formData.validate_only=this.model.event.personal_data_sent?"":"1"),n.each(this.getTrackerEventData(),function(e,t){return i("stat_metadata",t,e)})},event_register.prototype.eventRegister=function(e){var n=this,r=this,s=this.getText.bind(this),a=(r.$$("#eventreg_form"),this.$$(".b-registration__error")),t=(TWF2.Collections.H,TWF2.Collections.A,this.prependConsumerHost("event/widget_register/"+r.model.event.id,{subdom:r.model.event.subdomain})),d=this.mklog("eventRegister");if(e.preventDefault(),this.prepareRegistrationRequest(),r.model.formData.promocode&&r.model.formData.promocode!==r.model.enteredLegacyPromocode&&-1===r.model.enteredPromocodes.indexOf(r.model.formData.promocode))return d("Detected legacy promocode, applying and stopping"),void this.handleApplyPromocode();this.toggleSubmitButton(!1);var c=r.startWaitingFor(function(){return n.toggleSubmitButton(!0)});d("Sending request %O to %s",r.model.formData,t),this.notifyTrackers("clicked button eventRegister",{event_value:this.model.selectedTickets.sum}),this.T$.post(t,r.model.formData).done(function(e){c(),d("Response recieved: %O",e);var t,i,o=e.result;a.empty().hide(),n.$$(".i-question-control").removeClass("b-input-block_status_error"),n.$$(".control-group").removeClass("error"),n.$$(".b-error-block").remove(),!o&&e.error&&(o="error"),"error"===o?(t=e.error,d("Error returned: %O",t),"validation"==t?n.handleValidationErrors(e):n.displayErrorOnRegForm(s("Произошла ошибка на стороне сервера: ")+t)):"success"===o?(d("registration ok, processing routing"),i=e.status,r.model.order=e.order,"ok"===i?("charity"!==e.action&&(r.model.order.diploma_url=r.model.order.diploma_url+"?utm_campaign=tp_diploma_promo&utm_medium=tpd_widget&utm_source=tp_screen_reg_ok"),"charity"===e.action?r.route("charity"):r.model.order.has_tickets?r.route(r.settings.issueTickets?"tickets":"success"):r.route("success")):"pending"===i?r.route("pending"):"booked"==i&&r.route("pay")):"ok"===o&&n.openProcessingPersonalDataModal()}).fail(function(e,t,i){d("XHR error %d (%s): %s",e.status,t,i),"timeout"===t?n.displayErrorOnRegForm(s("Не удалось соединиться с сервером. Пожалуйста, попробуйте еще раз.")):500<=e.status&&e.status<600?n.displayErrorOnRegForm(s("Произошла ошибка на стороне сервера: ")+e.status+" ("+i+")"):429==e.status?n.displayErrorOnRegForm(s("Сработала система защиты от спама. Пожалуйста, попробуйте зарегистрироваться еще раз. Если ошибка повторится, обратитесь в службу поддержки по адресу support@timepad.ru.")):n.displayErrorOnRegForm(s("Произошла неизвестная ошибка коммуникации: ")+i),c()})},event_register.prototype.processPolicyResult=function(e,t){var i=this,o=TWF2.Collections.A,n=this.mklog("policyresult");null!==e.final_price&&(n("setting final price to "+e.pricing.total),t.sum_diff=-e.pricing.total_discount,t.sum=e.pricing.total,t.sum=Math.max(0,t.sum),o.each(e.pricing.ticket_types,function(t){n("Changing ticket#"+t.cat_id+" price");var e=o.whereSingle(i.model.event.tickets,function(e){return t.cat_id==e.id});e?i.settings.display_discounted_ticket_types?(e.new_price=t.price,e.h_new_price=i.formatSum(e.new_price),e.discount=t.discount,e.h_discount=t.discount?"(скидка "+i.formatSum(e.discount)+")":""):(e.new_price=null,e.h_new_price="",e.discount=null,e.h_discount=""):n("error: ticket#"+t.cat_id+" not found")})),e.pricing.order_discount&&(e.pricing.h_order_discount=this.formatSum(e.pricing.order_discount))},event_register.prototype.recountSelectedTickets=function(){var i=this;this.log("[Recounts] recountSelectedTickets");var o=0,e=this.currentWindowNode.seatcheck,t=e?e.i.getSelectedData():[],n=this.T$.Deferred(),r=this.model.selectedTickets={count:0,sum:0},s=this.model.separateSelectedTickets=[],a=TWF2.Collections.A,d=this.getFormSelectedTickets();if(a.each(this.model.event.tickets,function(e){if((o=d[e.id])&&(r.count+=o,r.sum+=o*e.price,!i.model.event.uses_multiank))for(var t=0;t<o;++t)s.push({re_id:e.id})}),this.model.event.uses_multiank&&a.each(this.model.attendees,function(e){e.reId&&s.push({re_id:e.reId})}),a.each(t,function(t){r.count++,r.sum+=+t.cache.price,i.model.event.uses_multiank||s.push({re_id:t.catId,place_id:t.id});var e=a.whereSingle(s,function(e){return e.re_id==t.catId&&!e.place_id});e&&(e.place_id=t.id)}),r.sum=Math.max(0,r.sum),this.model.selectedTicketByCat=d,this.obs.fireEvent("selectedTicketsRecounted",{}),this.model.event.uses_policies&&this.model.selectedTicketByCat.length){var c=this.$$(".selectedTicketsInfo");c.fadeTo("fast",.2),this.sendSituation().done(function(e){i.processPolicyResult(e,r)}).always(function(){c.fadeTo("fast",1),i.log("[Recounts/situation] resuming processing "),i.processSeletedTickets(r),n.resolve()})}else this.processSeletedTickets(r),n.resolve();return n},event_register.prototype.recountSelectedPlaces=function(){var i,o=this,e=this.currentWindowNode,t=this.getText.bind(this),n=e.seatcheck,r=n.i.getSelectedData().length,s=TWF2.Collections.A,a=n&&n.data?n.data.cats:[],d=this.T$(n.element).parents("body").find(".schk-scheme__proceed-btn");i=t(this.plural(r,"%s билет","%s билета","%s билетов"),[r]);var c={promocodes:s.toHash(this.model.enteredPromocodes,function(e,t){return{k:t,v:e}}),selectedTicketCategories:s.map(this.model.selectedTicketByCat,function(e,t){var i=s.whereSingle(a,function(e){return e.id==t});if(i)return{price:i.price,category_id:t,category_name:i.name,tickets_count:e}}),selectedTickets:s.map(this.model.separateSelectedTickets,function(t){var e=s.whereSingle(a,function(e){return e.id==t.re_id});if(e)return{price:e.price,category_id:t.re_id,category_name:e.name,meta:t.meta}})},l=this.prependConsumerHost("event/widget_run_policies/"+this.model.event.id,{subdom:this.model.event.subdomain});if(this.T$.post(l,this.$reserializeRequest({situation:c})).done(function(e){var t=0<e.final_price?" на сумму "+o.formatSum(e.final_price):"";o.T$(n.element).parents("body").find(".schk-scheme__selected-num").text(i+t)}),0<r){d.show();var u=this.model.event.uses_multireg?"Изменить выбор мест":"Выбрать другое место";this.$$(".js-schk-wrap__cover-btn").text(t(u))}else{u=this.model.event.uses_multireg?"Выберите места на схеме зала":"Выберите место на схеме зала";this.$$(".js-schk-wrap__cover-btn").text(t(u)),d.hide()}},event_register.prototype.handleTicketsSelection=function(){var e=this.currentWindowNode.seatcheck,t=this.model.event;!t.uses_multireg&&t.has_active_places&&(e.i.clearSeatsSelection(),this.updatePlacesList(),this.recountSelectedPlaces()),this.recountSelectedTickets()},event_register.prototype.sendSituation=function(){var i=this,o=this,n=this.T$.Deferred(),r=TWF2.Collections.A,s=this.mklog("sendSituation"),e=this.currentWindowNode.seatcheck,a=e&&e.data?e.data.cats:[],d={promocodes:r.toHash(this.model.enteredPromocodes,function(e,t){return{k:t,v:e}}),selectedTicketCategories:r.map(this.model.selectedTicketByCat,function(e,t){var i=r.whereSingle(o.model.event.tickets,function(e){return e.id==t})||r.whereSingle(a,function(e){return e.id==t});return{price:i.price,category_id:t,category_name:i.name,tickets_count:e}}),selectedTickets:r.map(this.model.separateSelectedTickets,function(t){var e=r.whereSingle(o.model.event.tickets,function(e){return e.id==t.re_id})||r.whereSingle(a,function(e){return e.id==t.re_id});return{price:e.price,category_id:t.re_id,category_name:e.name,meta:t.meta}}),buyerEmail:this.model.event.policy_features.email&&this.getQuestionValue("order_mail")||this.getQuestionValue("mail",0)};return s("sending situation for policy run: %O",d),this.abortPreviousXhr("widget_run_policies",function(){var e=i.prependConsumerHost("event/widget_run_policies/"+o.model.event.id,{subdom:o.model.event.subdomain}),t=i.T$.post(e,o.$reserializeRequest({situation:d}));return t.done(function(e){s("response recieved: %O",e),(i.model.policyResult=e).effects?n.resolve(e):n.fail()}).fail(function(){return n.fail()}),t}),n},event_register.prototype.getAppliedPolicies=function(){return this.model.policyResult&&this.model.policyResult.applied_policies&&this.model.policyResult.applied_policies.length?this.model.policyResult.applied_policies:[]},event_register.prototype.getFormSelectedTickets=function(e){void 0===e&&(e=["checkbox","seatcheck","count","hidden"]);var t=[],i=TWF2.Collections.A,o=i.toFlags(e);i.each(this.model.event.tickets,function(e){return t[e.id]=0}),o.count&&this.$$("select.b-reg-table__select").TWFiter(function(e){return t[e.data("reid")]=parseInt(e.val())}),o.checkbox&&this.$$("input.b-reg-table__select:checked").TWFiter(function(e){return t[e.data("reid")]=1}),o.hidden&&this.$$("input.b-reg-table__hidden").TWFiter(function(e){return t[e.data("reid")]=1}),o.count&&this.$$(".js-tickets_count_input").TWFiter(function(e){return t[e.data("reid")]=parseInt(e.val())});var n=this.currentWindowNode.seatcheck,r=n?n.i.getSelectedData():[],s=this.model.event.seatedTickets;return i.each(s,function(e){return t[e.id]=0}),o.seatcheck&&i.each(r,function(e){return t[e.catId]++}),t},event_register.prototype.setFormSelectedTickets=function(e,t){var o=this;void 0===t&&(t=["checkbox","count","hidden"]);var i=TWF2.Collections.A,n=i.toFlags(t),r=this.mklog("setFormSelectedTickets");r("Processing selectors of types %s",t.join("|")),r("Resetting selectors to zero"),this.clearFormSelectedTickets(t),null!==e&&(r("Setting ticket counts to %O",e),i.each(e,function(e,t){var i="";t&&null!==e&&(i="[data-reid="+t+"]"),n.checkbox&&(r("Setting checkbox of %d to %d",t,e),o.$$("input.b-reg-table__select"+i+":checked").attr("checked",0<e)),n.count&&(r("Setting select or plusminus of %d to %d",t,e),o.$$("select.b-reg-table__select"+i).val(e),o.$$(".js-tickets_count_input"+i).val(e)),n.hidden&&(r("Setting input type hidden of %d to %d",t,e),o.$$("input.b-reg-table__hidden"+i).val(e))}))},event_register.prototype.clearFormSelectedTickets=function(e){void 0===e&&(e=["checkbox","count","hidden"]);var t=TWF2.Collections.A.toFlags(e),i=this.mklog("clearFormSelectedTickets");t.checkbox&&(i("Clearing checkboxes"),this.$$("input.b-reg-table__select:checked").attr("checked",!1)),t.count&&(i("Clearing selects and plusminuses"),this.$$("select.b-reg-table__select").val(0),this.$$(".js-tickets_count_input").val(0)),t.hidden&&(i("Clearing input type hidden"),this.$$("input.b-reg-table__hidden").val(0))},event_register.prototype.disableFormSelectedTickets=function(){this.$$(".b-reg-table__plusminus, .b-reg-table select.b-reg-table__select").hide(),this.$$(".multiank_counter").show()},event_register.prototype.updateAttendeeCounts=function(){var i=this;this.log("[Recounts] updateAttendeeCounts"),this.$$(".multiank_counter").text(0);var t=[];TWF2.Collections.A.each(this.model.attendees,function(e){return t[e.reId]=t[e.reId]+1||1}),TWF2.Collections.A.each(t,function(e,t){i.$$("#rei_cont_"+t).find(".multiank_counter").text(e)}),this.setFormSelectedTickets(t),this.recountSelectedTickets()},event_register.prototype.updateTicketsSelectionInterface=function(){var e=this;this.log("[Recounts] updateTicketsSelectionInterface");var t=this.$$(".section-submit, .section-ank"),i=this.$$(".section-multiankadd"),o=!!this.model.attendees.length,n=this.model.event.uses_multiank,r=!(!this.model.selectedTickets||!this.model.selectedTickets.count),s=n&&this.settings.multiankSettings.initialSelects;if(this.settings.hideFormsWhenNoTickets&&(n&&o||!n&&r?(this.log("[tsi] showing regform"),t.show()):(this.log("[tsi] hiding regform"),t.hide())),s&&(o||this.flags.multiankSelectsReplaced||(this.log("[tsi] showing mass attendee adder"),i.show().removeClass("hide")),o&&(this.log("[tsi] hiding mass attendee adder"),i.hide()),o&&!this.flags.multiankSelectsReplaced&&(this.log("[tsi] disabling mass attendee selects"),this.disableFormSelectedTickets(),this.$$(".b-add-attendee").show(),this.flags.multiankSelectsReplaced=!0)),n&&(!s||this.flags.multiankSelectsReplaced)){this.log("[tsi] setting states for add-re selects...");var a,d,c,l,u=this.$$(".add-attendee"),h=this.T$;this.model.event.tickets.forEach(function(i){a=TWF2.Collections.A.arrayCount(e.model.attendees,function(e){return e.reId==i.id}),c=e.$$(".add-attendee-re").find(".attendee-re-option-"+i.id),d=e.$$(".change-attendee-re").find(".attendee-re-option-"+i.id).filter(function(e,t){return h(t).parent().val()!=i.id}).add(c),i.max&&a>=i.max?(e.log("[tsi] switching off availability of re#"+i.id),d.attr("disabled","disabled")):(e.log("[tsi] switching on availability of re#"+i.id),d.removeAttr("disabled").removeAttr("selected"))}),(l=this.$$(".add-attendee-re option").filter(function(e,t){return!h(t).attr("disabled")})).length?(this.log("[tsi] switching on adding more attendees"),l.first().attr("selected","selected"),u.removeClass("disabled")):(this.log("[tsi] switching off adding more attendees"),u.addClass("disabled"))}this.updateRePrices()},event_register.prototype.updateRePrices=function(){var t=this;this.model.event.tickets.forEach(function(e){e.h_new_price&&(t.log("[tsi] updating ticket pricing "+e.id+" → "+e.price+" (-"+e.discount+")"),t.$$("#rei_cont_"+e.id+" .js-reg-table-price").text(e.h_new_price),t.$$("#rei_cont_"+e.id+" .js-reg-table-discount").text(e.h_discount),t.$$(".attendee-re-option-"+e.id).text(e.name+" ("+e.h_new_price+")"))})},event_register.prototype.toggleSubmitButton=function(e,t,i){void 0===t&&(t=this.$$(".b-pro-wiget__reg-button")),void 0===i&&(i=this.$$(".js-pro-widget-terms-popup")),e?(t.removeClass("disabled").removeAttr("disabled"),i.addClass("b-pro-widget__terms-popup_hidden")):t.addClass("disabled").attr("disabled","disabled")},event_register.prototype.getTotalText=function(e){var t,i=this.getText.bind(this);return this.model.event.uses_ticket_choice?e.count?(t=i("Вы выбрали")+" ",t+=e.count+" ",t+=this.plural(e.count,i("билет"),i("билета"),i("билетов")),e.sum&&(t+=" "+i("на сумму")+" "+this.formatSum(e.sum))):t=this.model.event.uses_multireg?i("Вы не выбрали ни одного билета!"):i("Вы не выбрали билет!"):t=e&&e.sum?i("Стоимость билета — ")+this.formatSum(e.sum):i("Регистрация бесплатна."),e&&e.count&&e.sum_diff&&(e.sum_diff<0?t+=" ("+i("скидка")+" "+this.formatSum(-e.sum_diff)+")":0<e.sum_diff&&(t+=" ("+i("включая сервисный сбор")+" "+this.formatSum(e.sum_diff)+")")),t},event_register.prototype.processSeletedTickets=function(e){var t,i=this.$$(".selectedTicketsInfo");e=e||this.model.selectedTickets;if(t=this.getTotalText(e),this.model.event.uses_ticket_choice&&(e.count?i.removeClass("error"):i.addClass("error")),i.text(t),this.model.event.uses_policies){var o=i.parents(".b-reg-table__row"),n="b-reg-table__row_type_promo";this.$$(".policyResultRow").remove(),this.model.policyResult&&this.model.policyResult.applied_policies.length?o.addClass(n).before(this.renderTemplate("_policyResult",this.model)):o.removeClass(n)}this.updateTicketsSelectionInterface(),this.changeSubmit(e)},event_register.prototype.changeSubmit=function(e){var t=this.getText.bind(this),i=TWF2.Collections.H,o=this.$$(".b-pro-wiget__reg-button"),n=this.settings.mainFormButtonSettings.texts,r=this.$$(".js-acquirings"),s=this.$$('input[name="accepted_terms"]'),a={accepted_terms_age:!1,accepted_terms_illness:!1,accepted_terms_virus:!1,accepted_terms_contacts:!1},d=this.$$('input[name ^= "accepted_terms_"]'),c=!0;this.model.event.uses_processing_personal_data&&d.length&&d.each(function(){TWF2.T$(this).is(":checked")&&void 0!==a[this.name]&&(a[this.name]=!0),TWF2.T$(this).is(":visible")||(c=!1)}),e.count?(this.toggleSubmitButton(!0),this.model.event.uses_multiank&&!this.flags.multiankSelectsReplaced?o.text(t(n.proceed)):e.sum?o.text(t(n.buy)+" "+(1<e.count?t(n.items[1]):t(n.items[0]))):o.text(t(n.register)),e.sum?r.show():r.hide(),(s.is(":visible")&&!s.is(":checked")||this.model.event.uses_processing_personal_data&&c&&!i.ifAll(a,function(e){return!!e}))&&this.toggleSubmitButton(!1)):(this.toggleSubmitButton(!1),o.text(t(n.atleast))),this.settings.mainFormButtonSettings.staticText&&o.text(t(this.settings.mainFormButtonSettings.staticText))},event_register.prototype.reloadEvent=function(e){var t={event:this.model.event.id,promocode:this.model.enteredLegacyPromocode};this.settings.locale&&(t.locale=this.settings.locale),this.getEvent(t,e)},event_register.prototype.setUpQuestions=function(o){var t=this,e=this.T$;e.each(this.defaultQuestions.slice(0).reverse(),function(e,t){o.questions.unshift(t)}),o.master_questions=[],e.each(o.questions,function(e,i){i[i.type]=!0,i.id&&!i.formname&&(i.formname="question"+i.id),i.multiank_master&&(i.vars&&(i.vars_unfold=t.$unfold(i.vars,function(e,t){return{text:t,num:e+1,aname:i.formname+"-"+e}})),o.master_questions.push(i)),i.description&&(i.description=i.meta.comment=TWF2.Util.S.nl2br(i.description)),i.meta.dadata&&t.loadDadata()}),o.has_master_questions=!!o.master_questions.length},event_register.prototype.initalizeAnk=function(){var e=this.model.event,t=this.settings,i=null,o=this.mklog("Init ank");o("(Re)initializing regform"),e.tickets.length&&(i=e.tickets[0].id),this.obs.fireEvent("preInitializeAnk",{e:e,reId:i},this),e.has_master_questions&&this.settings.prefill&&(o("Prefilling master questions"),t.prefill.order&&this.prefillQuestions(e.master_questions,t.prefill.order)),!i||!t.multiankSettings.addFirstAttendee&&e.uses_multiank||(o("Adding first attendee"),this.addAttendee(i)),this.flags.ankInitialized=!0},event_register.prototype.postprocessEventModel=function(s){var a=this,d=this.mklog("postprocessEventModel"),m=TWF2.Collections.A,e=TWF2.Collections.H,t=(TWF2.Util,this.getText.bind(this)),r=this;d("Begin"),r.model.attendees=[];var i=[],o=[];s.has_promocode&&(m.each(s.tickets,function(e){e.has_promocode?i.push(e):o.push(e)}),s.tickets=i.concat(o)),s.min_price=1/0,s.has_promocode=s.has_promocode||s.policy_features.promocode;var c=s.tickets.length,l=i.length;if(m.each(s.tickets,function(e,t){if(d("Postprocessing ticket '%s' (%d)",e.name,e.id),e.h_price=a.formatSum(e.price),s.min_price=Math.min(e.price,s.min_price),s.max_price=Math.max(e.price,s.max_price),s.has_active_places||(1==c&&e.min<=1?(d("Forcing selection of %s #%d (the only choice)",e.name,e.id),e.min=1,e.force_check=!0):t||s.uses_multireg||(d("Forcing selection of %s #%d (default choice)",e.name,e.id),e.force_check=!0)),e.has_promocode&&1==l&&(d("Forcing selection of %s #%d (promocode autoselect)",e.name,e.id),e.force_check=!0),e.available||(e.min=e.max=0),e.ticket_choices=[],a.settings.use_plusminus)1==e.min&&(e.min=0);else for(var i=e.min;i<=e.max;i++)e.ticket_choices.push({val:i,selected:i==e.min&&e.force_check});if(e.comment&&(e.comment=TWF2.Util.S.nl2br(e.comment)),s.show_text_tickets_remain)if(0<e.tickets_left){var o=r.plural(e.tickets_left,"Остался ","Осталось ","Осталось "),n=r.plural(e.tickets_left," билет"," билета"," билетов");e.text_tickets_remain=o+e.tickets_left+n}else e.tickets_left||"ok"==e.status?e.tickets_left||"ok"!=e.status||(e.text_tickets_remain="Количество билетов не ограничено"):e.text_tickets_remain="Билеты закончились";e.default_count=e.force_check?1:0}),s.has_active_regular_tickets=!!s.tickets.length,r.model.enteredLegacyPromocode&&!s.promocode_ok&&(s.promocode_wrong=!0),s.recurring_events&&s.recurring_events.length){var u=this.context.loader.getSandbox("momentjs").moment,n={};s.recurring_events_by_day=[],m.each(s.recurring_events,function(e){e.moment=u.parseZone(e.date_iso8601),e.ymd=+e.moment.format("YYYYMMDD"),e.tickets_left_h=e.tickets_left+" "+a.plural(e.tickets_left,t("билет"),t("билета"),t("билетов")),e.min_price_h=a.formatSum(e.min_price),n[e.timestamp]=n[e.timestamp]||[],e.unavaliable&&!a.settings.recurringShowClosed||n[e.timestamp].push(e)}),s.has_recurring_events_by_day=!!s.recurring_events.length;var h,p=!0,g=null;if(d("Restructuring recurring_events_by_day"),e.each(n,function(e){if(e.length){var t=e[0],i=+t.moment.format("DDD"),o=null!==g?i-g:0,n=u(h||t.moment);for(d("Processing %s (#%d), %d days since %d",t.date_day,i,o,g),p=p&&1===e.length;a.settings.recurringShowEmptyIntervals&&1<o;){o--;var r=n.add(1,"days");d("Adding empty spanning day %s",r.format("ll")),s.recurring_events_by_day.push({moment:u(r),ymd:+r.format("YYYYMMDD"),day:r.format("LL").replace(/\d\d\d\d\s*(.\.)?/,""),day_of_week:r.format("dddd"),events:[],month:r.format("MMMM"),year:+r.format("YYYY")})}s.recurring_events_by_day.push({moment:u(t.moment),ymd:+t.ymd,day:t.date_day,day_of_week:t.day_of_week,events:e,month:t.month_number,year:t.year}),g=i,h=t.moment}}),"vertical-days"===this.settings.recurringDatesMode){d("Building vertical-days grid");var f={},_={is_header:!0,cells:[]};m.each(s.recurring_events_by_day,function(e){d("Adding header for %s",e.ymd),_.cells.push({ymd:e.ymd,is_header:!0,day_of_week:e.moment.format("dd"),day_month:e.day,is_weekend:6<=e.moment.format("E")})}),m.each(s.recurring_events,function(e){var t=e.moment.format("HH:mm"),i=+e.moment.format("m")+60*e.moment.format("H");d("Collecting event with time %s (%s second of day)",t,i),f[i]=f[i]||[],f[i].push(e)}),d("Events by time = %O",f);var v=e.mapToArray(f,function(e,t){return t}).sort(function(e,t){return e-t});if(d("Times list = %O",v),s.recurring_events_grid=[_],m.each(v,function(i){var o={cells:[]};m.each(_.cells,function(t){var e={events:m.where(f[i],function(e){return e.ymd==t.ymd})};o.cells.push(e)}),s.recurring_events_grid.push(o)}),this.settings.recurringVerticalCompress){function k(){var h=a.mklog("tsrow compression"),e=m.copy(s.recurring_events_grid);m.each(e,function(a,d){if(!a.is_header){function c(e){return e?m.arrayCount(e.cells,function(e){return!!e.events}):0}var l=e[d-1],u=e[d+1];l.is_header&&(l=null),m.each(a.cells,function(e,t){h("Core at %d,%d",d,t);var i=[l,a,u],o=m.copy(i).sort(function(e,t){return c(t)-c(e)})[0],n=o&&o.cells&&o.cells[t];if(n&&!n.events.length){h("Core gravity center empty, trying to attract");var r=m.map(m.where(i,function(e){return e&&e.cells}),function(e){return e.cells[t]}),s=m.whereSingle(r,function(e){return e.events.length});s&&(h("Found cell to attract"),n.events=s.events,s.events=[])}})}}),s.recurring_events_grid=m.where(e,function(e){return e.is_header||0<m.arrayCount(e.cells,function(e){return e.events&&e.events.length})})}d("Will compress timeslots %d times...",this.settings.recurringVerticalCompress);for(var y=0;y<this.settings.recurringVerticalCompress;y++)d("Compressor run %d",y+1),k()}}"auto"===this.settings.recurringDatesMode&&p&&(this.model.squishRecurringDates=!0)}r.setUpQuestions(s),s.uses_phone=!!TWF2.Collections.A.arrayCount(r.model.event.questions,function(e){return"phone"==e.type}),d("Processed")},event_register.prototype.getEventCacheKey=function(e){return TWF2.Collections.H.mapToArray(e,function(e,t){return t+"_"+e}).sort().join("__")},event_register.prototype.loadEventModel=function(e,n,r){function t(e,t){if(void 0===t&&(t=!0),!(s=e)||!s.id||s.error){var i="unknown";return s&&("entity_does_not_exist"==s.error?i="404":"not_authorized"==s.error&&(i="403")),d("error %O!",s),void(r&&r(i))}a.eventCache[l+"_u"]=TWF2.ecopy(s),a.resetEventModel(),c.model.event=s,c.model.phone_moscow=s.phone_moscow,c.model.phone_russia=s.phone_russia,a.handlePromocodeNote(),a.switchLocale(a.settings.locale||s.locale);var o=[];s.is_recurring&&(o=a.lazyPackages.postprocessRecurringEvent),d("Additional packages to load: %O",o),a.context.loadPackages(o,function(){d("Additional packages ready"),t&&a.postprocessEventModel(s),a.flags.ankInitialized||a.initalizeAnk(),a.loadOrgTrackers(),d("Loaded"),t&&(d("Saving postprocessed cache"),a.eventCache[l]=TWF2.ecopy(a.model.event)),n(s)})}var s,a=this,i={url:this.prependConsumerHost("api/event_model"),method:"GET",crossDomain:!0,dataType:"jsonp",data:e},d=this.mklog("MODEL"),c=this,o=c.T$,l=this.getEventCacheKey(e);TWF2.microguid(4);this.eventCache[l]?(d("[P] Event postprocessed model cache hit"),t(this.eventCache[l],!1)):this.eventCache[l+"_u"]?(d("[ ] Event model cache hit"),t(this.eventCache[l+"_u"])):(d("Event model requested"),o.ajax(i).done(function(e){d("response recieved"),t(e)}))},event_register.prototype.getEvent=function(e,i){var o=this,n=this,r=TWF2.cascade({response_type:"jsonp"},e);r.event?this.waitFor(function(t){o.loadEventModel(r,function(e){t(),i(e)},function(e){t(),n.route("widget_error",{type:e})})},{caption:"Загрузка информации, пожалуйста подождите"}):n.route("widget_error",{type:"400"})},event_register.prototype.getAttendeeCount=function(){return this.model.attendees.reduce(function(e,t){return void 0!==t?e+1:e},0)},event_register.prototype.getHumanPlace=function(t){var i,e=this.currentWindowNode.seatcheck.data.tooltip,o=[],n=TWF2.Collections.A,r=this.getText.bind(this);return n.each(e,function(e){void 0!==(i=t[e.key])&&o.push(r(e.name)+" "+i)}),o.join(" ")},event_register.prototype.addAttendee=function(e,t){var s=this;void 0===t&&(t={});var a={num:this.getAttendeeCount(),questionsSet:[],displayNum:this.getAttendeeCount()+1,isFirst:!this.getAttendeeCount()&&this.settings.multiankSettings.distinguishFirstAttendee,reId:e},i=this.T$,d=this.mklog("FORM-model");if(d("adding attendee #%d model for re#%d",a.num,e),this.obs.fireEvent("preAddAttendee",{additionalInfo:t,reId:e,attendee:a},this),this.model.event.uses_places){var o=t.seatcheck;o&&(d("Adding form for SEATED category!"),a.isSeated=!0,a.seatedInfo=o)}return i.each(this.model.event.questions,function(e,t){d("adding attendee model question %d",e);var i,o,n=TWF2.ecopy(t),r=s.getText.bind(s);n.name=r(n.name),o=n.multiank_master?function(e){return e}:function(e){return"user_forms["+a.num+"]["+e+"]"},n[t.type]=!0,i=t.formname,t.id&&!t.formname&&(i="question"+t.id),n.upload&&(i="uc-"+i),n.formname=o(i),t.uses_phone_verify&&(n.phone_verify_formname=o(i+"__pvcode")),t.vars&&(n.vars_unfold=s.$unfold(t.vars,function(e,t){return{text:t,num:e+1,aname:o(i+"-"+e)}})),n.multiank_master||a.questionsSet.push(n)}),this.settings.prefill&&this.settings.prefill.attendees&&(d("looking for attendee #%d prefill data",a.num),this.settings.prefill.attendees[a.num]&&(d("prefilling attendee #%d prefill data",a.num),this.prefillQuestions(a.questionsSet,this.settings.prefill.attendees[a.num]))),a.deletable=!a.isFirst||a.isSeated,this.model.attendees.push(a),a},event_register.prototype.getEmbedderUrl=function(e){var t=(e=e||window).document.location.toString(),i=this.mklog("getEmbedderUrl");if(i("document url determined as %s",t),e.frameElement){try{if(i("Trying to go up"),e.top&&e.top.document)return i("Attempting to up"),this.getEmbedderUrl(e.top)}catch(e){i("Sad, can't go up: %s",e)}e.document.referrer&&(i("We are in iframe, using its referer %s"),t=e.document.referrer)}return t},event_register.prototype.getUtms=function(e){void 0===e&&(e=document.location.search);var t=TWF2.Collections.H,i=TWF2.Util,o=TWF2.Util.EnsureType,n=TWF2.extend,r=i.QueryString.fromUrl(e).fragments,s=o.H(this.settings.prefill.utm);return t.where(n(r,s),function(e,t){return!!t.match("^utm_")})},event_register.prototype.getCookies=function(){var i=this.settings.forwardCookies;return!i&&i.length?{}:TWF2.Collections.H.where(TWF2.Util.Cookies.getCookies(),function(e,t){return 0<=i.indexOf(t)})},event_register.prototype.getTrackerEventData=function(){var i=this.getUtms(),e={event_id:+this.model.event.id||0,org_id:+this.model.event.org||0,event_cats:this.model.event.categories?this.model.event.categories.join(","):"",reg_count:this.model.event.tickets?+this.model.event.tickets.length:0,questions_count:+this.model.event.questions_count||0,max_price:+this.model.event.max_price||0,from:"widget",widget_mode:"default",widget_id:null,widget_consumer_url:document.location.href,use_multireg:!!this.model.event.uses_multireg,widget_use_multiank:!!this.model.event.uses_multiank,utms:i};return this.settings.addFormData&&TWF2.Collections.H.each(this.settings.addFormData,function(e,t){return t.match("^utm_")&&(i[t]=e)}),"button"!=this.settings.initialRoute&&!this.settings.popup.triggerSelector||(e.widget_mode="popup"),this.model.isInTimepad?e.from="isInTimepad":this.settings.iframe.useVkScroll?e.widget_mode="vk":this.settings.isInEventListWidget&&(e.widget_mode="event_list_widget"),this.settings.isWidgetBare&&(e.widget_mode="bare_widget"),this.settings.isWidgetFacebook&&(e.widget_mode="fb_widget"),this.customizationId&&(e.widget_id=+this.customizationId),e},event_register.prototype.loadOrgTrackers=function(){var o=this,e=TWF2.Collections.H,t=TWF2.Util,n=(t.EnsureType,this.mklog("loadOrgTrackers")),r=(TWF2.cascade,0);this.settings.load_org_trackers?this.model.event&&this.model.event.org_trackers?(e.each(t.EnsureType.H(this.model.event.org_trackers),function(e,t){var i="org_"+t;e&&"string"==typeof e&&!o.settings.trackers[i]?(o.settings.trackers[i]={enable:!0,trackerName:"tpw_org_"+t,trackerId:e,isOrg:!0},n("Added org tracker (%s), id %s",t,e),r++):n("Ignoring org tracker (%s) with an empty id",t)}),r||n("No trackers added")):n("No org trackers configured"):n("Loading of org trackers is disabled")},event_register.prototype.notifyTrackers=function(o,n){var t=this;void 0===n&&(n={});function i(e){return s[e]&&s[e].enable&&(!n.selective_trackers||0<=n.selective_trackers.indexOf(e))}function e(e,t){return i(e)&&t(s[e])}function r(e){return"[TimePad] "+e}var s=this.settings.trackers,a=TWF2.Collections.H,d=this.getTrackerEventData(),c=this.mklog("notifyTrackers"),l={event_id:d.event_id,widget_mode:d.widget_mode},u=n.event_value?+n.event_value:0;c("Tracking %s",o),e("cube",function(e){c("Tracked Cube: %s",o),t.sendEventToCube(o,d,e.sig)}),e("ref",function(e){c("Tracked TPref: %s",o),t.sendEventToTracker(o,d)}),e("org_facebook",function(e){c("Tracked Facebook: %s",o),window.fbq&&window.fbq("trackCustom",r(o))}),e("org_vkontakte",function(e){c("Tracked Vkontakte: %s",o),window.VK&&window.VK.Retargeting&&window.VK.Retargeting.Event(r(o))}),i("org_ga")&&this.gaLoad(function(e,t){try{e(t.trackerName+".send",{hitType:"event",eventCategory:"user",eventAction:r(o),eventLabel:(i=l,a.mapToArray(i,function(e,t){return t+":"+e}).join(";")),eventValue:u,nonInteraction:+!!n.none_interactive}),c("Tracked GA: %s",o)}catch(e){c("Failed tracking GA: %s, %s",o,e)}var i},"org_ga"),i("org_metrika")&&this.metrikaLoad(function(e){try{e.reachGoal(r(o),l),c("Tracked Metrica: %s",o)}catch(e){c("Failed tracking Metrica: %s, %s",o,e)}},"org_metrika"),i("org_roistat")&&this.roistatLoad("org_roistat")},event_register.prototype.sendPayRequest=function(e){e.preventDefault();var t="/org/send_ticket_request/"+this.model.order.user_id+"/"+this.model.order.registration.id,i=this.getText.bind(this),o=e.target,n=this.$$(".no-contract__notice"),r={url:t=this.prependConsumerHost(t,{subdom:this.model.event.subdomain}),type:"GET",dataType:"jsonp"};this.T$(o).attr("disabled","disabled").addClass("disabled"),this.T$.ajax(r).done(function(e){"ok"==e.send_status?n.html(i("Заявка отправлена. В ближайшее время организаторы свяжутся с вами.")):e.error&&n.html(i("Что-то пошло не так. Попробуйте отправить заявку позже."))})},event_register.prototype.showTermsAcceptPopup=function(e){var t=this.$$(".js-pro-widget-terms-popup"),i=this.$$("#eventreg_submit"),o=this.$$('input[name="accepted_terms"]');i.hasClass("disabled")&&!o.is(":checked")&&t.removeClass("b-pro-widget__terms-popup_hidden")},event_register.prototype.getQuestionValue=function(e,t){void 0===t&&(t=null);var i=e;return null!==t&&(i="user_forms["+t+"]["+e+"]"),this.$$('[name="'+i+'"]').val()},event_register.prototype.handlePhoneRequiresVerificationChange=function(e){var t=this.mklog("sendSMSVerify"),i=this.T$(e.target),o=i.data("phone-verify"),n=this.$$("[data-phone-verify='"+o+"'].js-verify-btn"),r=i.val().replace(/[^\d]/,"").length,s=this.$$("[data-phone-verify='"+o+"'].js-verify-desc"),a=this.$$("[data-phone-verify='"+o+"'].js-verify-block-hideble");t("Len of phone is: ",r),i.removeClass("phone_valid phone_invalid"),0<r?(t("Enabling verify interface"),a.show(),s.hide(),n.removeAttr("disabled")):(t("Disabling verify interface"),a.hide(),s.hide().filter(".js-verify-desc_nophone").show(),n.attr("disabled","disabled"))},event_register.prototype.handlePhoneVerifySend=function(e){function i(e){var o,n=s.mklog("checkSMSVerify"),r=parseInt(e);function t(){var e=1e3*r-Date.now(),t=Math.floor(e/1e3%60),i=Math.floor(e/1e3/60%60);u.text(("0"+i).slice(-2)+":"+("0"+t).slice(-2)),t<=0&&i<=0&&(n("Can resend code now"),c.hide().filter(".js-verify-desc_resend").show(),clearInterval(o))}n("Next code try timestams is ",r),t(),o=setInterval(t,500)}var s=this,o=this.mklog("sendSMSVerify"),t=this.T$(e.target).data("phone-verify"),n=this.$$("[name='"+t+"']"),r=this.$$("[data-phone-verify='"+t+"'].js-verify-code"),a=this.$$("[data-phone-verify='"+t+"'].js-verify-btn"),d=this.$$("[data-phone-verify='"+t+"'].js-verify-label"),c=this.$$("[data-phone-verify='"+t+"'].js-verify-desc"),l=this.$$("[data-phone-verify='"+t+"'].js-verify-info"),u=this.$$("[data-phone-verify='"+t+"'].js-verify-desc_preresend").find(".js-verify-timer"),h=this.$$("[data-phone-verify='"+t+"'].js-verify-info-danger").hide(),m={event:this.model.event.id,locale:this.locale,phone:n.val()},p={url:this.prependConsumerHost("api/widget_verify_phone_send"),method:"POST",crossDomain:!0,data:m};this.abortPreviousXhr("widget_verify_phone_send",function(){o("Requesting sms code for %s",m.phone);var e=s.T$.ajax(p);return e.done(function(e){if(o("response recieved: %O",e),"success"===e.result)l.hide().filter(".js-verify-info-warning").show(),d.hide().not(".js-verify-label_nophone").show(),c.hide().filter(".js-verify-desc_preresend").show(),a.hide(),r.show(),i(""+e.next_try),r.data("code-len",e.code_len),o("Code len is: ",e.code_len);else{var t="";t="verification_throttled"==e.error?"Не удалось отправить код: слишком мало времени прошло с отправки предидущего кода. Следующая попытка будет доступна через "+e.timeout+" секунд ("+e.time_left+").":'Не удалось отправить код. Ошибка "'+e.error+'"',h.text(t).show()}}).fail(function(){return h.text("Не удалось соединиться с сервером, попробуйте еще раз").show()}),e}),e.preventDefault()},event_register.prototype.handlePhoneVerifyInput=function(e){var t=this,i=this.mklog("checkSMSVerify"),o=this.T$(e.target).data("phone-verify"),n=this.$$("[name='"+o+"']"),r=this.T$(e.target),s=r.val(),a=+r.data("code-len"),d=this.$$("[data-phone-verify='"+o+"'].js-verify-desc"),c=this.$$("[data-phone-verify='"+o+"'].js-verify-info");if(!a)return i("No idea what is code_len, no smartass actions"),void n.addClass("phone_invalid");if(s.length===a){i("Verifying code");var l={event:this.model.event.id,phone:n.val(),vcode:s},u={url:this.prependConsumerHost("api/widget_verify_phone_check"),method:"POST",crossDomain:!0,data:l};this.abortPreviousXhr("widget_verify_phone_check",function(){i("Checking sms code %s for %s",s,l.phone);var e=t.T$.ajax(u);return e.done(function(e){i("response recieved: %O",e),e.code_valid?(i("Phone is valid!"),c.hide().filter(".js-verify-info-success").show(),d.hide(),n.addClass("phone_valid")):(i("Phone is not valid!"),n.addClass("phone_invalid"))}),e})}else i("Input code length is %s, expecting %s. Ignoring for now",s.length,a)},event_register.prototype.handleShowVKPay=function(e){e.preventDefault(),this.showVKPay()},event_register.prototype.showVKPay=function(){var e=this,t=this.mklog("showVKPay"),i=window.VK,o=this.model.order.vk_pay_params;t("Trying to made VKPay payment");try{i.init(function(){t("Success of VK.init"),e.waitFor(function(e){i.callMethod("openExternalApp","vkpay",o),t("'openExternalApp' called with: ",o),setTimeout(e,3e4)},{caption:"Открываем окно оплаты VKPay..."})})}catch(e){this.log("VKPay payment fails in the very beginning: "+e)}},event_register.prototype.handleCharity=function(e,t){e.preventDefault();function i(){r.hide(),s.show(),n.show()}var o=this.T$(e.target),n=this.$$(".js-charity-info"),r=this.$$(".js-charity-show"),s=this.$$(".js-charity-hide"),a=this.$$(".js-charity-amount");"checkbox"===t?o.is(":checked")?(i(),a.removeAttr("disabled")):a.attr("disabled","disabled"):"show"===t?i():(r.show(),s.hide(),n.hide())},event_register.prototype.checkVKPay=function(){return window.VK&&this.model.prefill&&this.model.prefill.aux&&this.model.prefill.aux.vk_installation_id&&this.model.event&&this.model.event.uses_vk_pay},event_register.prototype.formatSum=function(e){var t=this.getText.bind(this),i=t("%s руб."),o=t("бесплатно");return this.model.event&&this.model.event.currency_formatter&&(i=this.model.event.currency_formatter),e?i.replace("%s",e):o},event_register}(TWF2.RichWidget);WidgetPrototypes.event_register=event_register}(WidgetPrototypes=TWF2.WidgetPrototypes||(TWF2.WidgetPrototypes={}))}(TWF2=TWF2||{}),window.TWF2.WidgetPrototypes.event_register.prototype._tpls={},window.TWF2.WidgetPrototypes.event_register.prototype._css="",window.TWF2.WidgetPrototypes.event_register.prototype.extCss="https://timepad.ru/js/tpwf/widgets/comp/event_register.iframe.css",window.TWF2.WidgetPrototypes.event_register.prototype._locales={};
window.TWF2.WidgetPrototypes.event_register.prototype._locales.en={"К сожалению, мы не можем принять оплату за билеты, так как организатор события не подключил возможность покупки билетов через наш сайт. Чтобы оплатить выбранные билеты, рекомендуем вам связаться с организатором и уточнить, как можно оплатить участие.":"Unfortunately, event host decided not to sell tickets online. We suggest you contact the host for information about payment options.",'Продолжая регистрацию, вы&nbsp;подтверждаете свое согласие с&nbsp;условиями <a href="http://timepad.ru/upload/docs/TimePad_useragreement.pdf" target="_blank">Пользовательского соглашения</a> и':'By registering to this event you confirm your acceptance of the <a href=\\"http://timepad.ru/upload/docs/TimePad_useragreement.pdf\\" target=\\"_blank\\">User agreement</a> and the','Продолжая регистрацию, вы&nbsp;подтверждаете свое согласие с&nbsp;условиями <a href="{{event.domain}}/org/user_agreement" target="_blank">Пользовательского соглашения</a> и':'By registering to this event you confirm your acceptance of the <a href=\\"{{event.domain}}/org/user_agreement_en.pdf\\" target=\\"_blank\\">User agreement</a> and the',"Подтверждение участия будет выслано вам организаторами на адрес, указанный при регистрации. Напоминаем, что без подтверждения регистрация считается недействительной.":"Your application is received and is waiting for approval. You will be notified by e-mail when your registration is approved. Please note that your registration is not valid before it is approved!",'Я подтверждаю свое согласие с условиями <a href="http://timepad.ru/upload/docs/TimePad_useragreement.pdf" target="_blank">Пользовательского соглашения</a> и':'I confirm my acceptance of the <a href="http://timepad.ru/upload/docs/TimePad_useragreement_en.pdf" target="_blank">User agreement</a> and the',"В качестве благодарности за заказ билетов на TimePad вам предоставляется возможность выбрать один из подарков-скидок в магазинах наших партнеров!":"As a thank you for ordering your tickets at TimePad you get an opportunity to chose one of the gifts-discounts in our partners' stores.","К сожалению, организатор этого события решил не продавать билеты он-лайн. Чтобы узнать, как вы можете оплатить свое участие, свяжитесь с ним.":"Unfortunately, event host decided not to sell tickets on-line. Please, contact him for information about payment options.",'Я подтверждаю свое согласие с условиями <a href="{{event.domain}}/org/user_agreement" target="_blank">Пользовательского соглашения</a> и':'I confirm my acceptance of the <a href="{{event.domain}}/org/user_agreement_en" target="_blank">User agreement</a> and the',"Распечатайте ваши билеты прямо сейчас, если у вас есть возможность. Мы также отправили ссылки на них на почту":"Print out your tickets as soon as you have an opportunities. We've also sent links to them to","К сожалению, виджету регистрации не удалось загрузиться. Пожалуйста, обратитесь в службу поддержки по адресу":"Unfortunately this widget failed to load. Please contact our support at","Договором оказания услуг по организации мероприятия и политикой возвратов":"Event hosting services terms and the policy of returns","Вы можете попробовать зарегистрироваться на событие через систему TimePad":"You can try and register for this event with TimePad","Пожалуйста, проверьте правильность заполнения полей, выделенных красным.":"Errors detected in highlighted fields. Please correct them and try again.","Я хочу получать анонсы событий этого организатора по электронной почте":"Subscribe to organization","Платежная сессия завершена. Нажмите «Далее» для продолжения оплаты.":"Payment session expired. Press «Continue» to proceed with payment.","Не удалось соединиться с сервером. Пожалуйста, попробуйте еще раз.":"Failed to connect to server. Please try again.","Заявка отправлена. В ближайшее время организаторы свяжутся с вами.":"Request sent. Event hosts will contact you shortly.","Продолжая регистрацию, вы подтверждаете свое согласие с условиями":"By registering to this event you confirm your acceptance of the","В письме обязательно укажите событие, на которое вы их покупали.":"In your letter, make sure to specify the event for which you have bought your tickets.","К сожалению, на данный момент доступных для регистрации дат нет":"Unfortunately there are no dates left","Сервис временно недоступен. Пожалуйста, повторите попытку позже":"Service is temporarily unavailable. Please try again later.","Время оплаты заказа ограничено! До окончания платежной сессии:":"Payment period is limited! Time left till the end of payment session:","После этого вернуть введенные вами данные будет невозможно.":"It will be impossible to restore the data you've entered.","Если билеты не пришли, пожалуйста, напишите нам об этом на":"If you didn't recieve your tickets, please email us at","Код с обратной стороны карты должен состоять из трёх цифр":"CVC/CVV must contain 3 digits","Хочу получать рекомендации интересных событий от TimePad":"I want to receive recommendations of interesting events from TimePad","Что-то пошло не так. Попробуйте отправить заявку позже.":"Something went wrong. Please, try to submit the request later.","Необходимо подтвердить согласие с условиями и договором":"You have to confirm your acceptance of the agreement and the terms","мероприятие пройдет, а диплом останется у вас навсегда":"the event will pass, the diploma will stay with you forever","диплом усилит ваше резюме и поможет карьерному росту":"the diploma will enhance your résumé and help your career growth","Договором оказания услуг по организации мероприятия":"Event hosting services terms","подтверждающий вашу регистрацию на это мероприятие":"configming your registration for this event","Время брони билета ограничено. Бронь будет снята":"Your reservation will expire","В имени владельца карты слишком много символов":"Cardholder name must contains less symbols","В имени владельца карты слишком мало символов":"Cardholder name must contains more symbols","Продолжая регистрацию, вы принимаете условия":"By registering to this event you accept","и согласны на обработку персональных данных.":"and personal data processing agreement","Произошла неизвестная ошибка коммуникации:":"Unknown connection error:","согласие на обработку персональных данных":"personal data processing agreement","Как оплатить, получить или вернуть билет?":"Help and support","поделитесь вашими достижениями с близкими":"share your accomplishments with those around you","В имени владельца карты допущены ошибки":"Cardholder name is incorrect","Зарегистрироваться на событие на сайте":"You can also register on our site","Пожалуйста, сообщите об этом по адресу":"Please report this error at","Произошла ошибка на стороне сервера:":"Server returned an error:","Введите код с обратной стороны карты":"Enter CVC/CVV","Три последние цифры с оборота карты":"3 digits on the back","Ваши билеты. Распечатайте их сейчас":"Here are your tickets. Print them out now.","Закажите электронный диплом TimePad":"Order a digital diploma by TimePad","Или выберите другой способ оплаты":"Or you can choose a different payment method","Некорректное значение года/месяца":"Year or month is incorrect","и пришлите ссылку на эту страницу":"and send us a link to this page","Вы зарегистрировались на событие":"You were registered for the","Вы не выбрали ни одного билета!":"Please select at least one ticket!","В e-mail адресе допущены ошибки":"Incorrect mail","Регистрация на событие закрыта":"Event registration is closed","В номере карты допущены ошибки":"Card number is incorrect","Латинские буквы, как на карте":"Cardholder name","Сумма включает сервисный сбор":"Total includes a service fee","Выберите места на схеме зала":"Please select your seats","Выберите место на схеме зала":"Please select your seat","Пользовательского соглашения":"User agreement","Вы заказали следующие билеты":"Your order","Некорректное значение месяца":"Month is incorrect","Не удалось обработать платёж":"Failed to process the payment","Выберите хотя бы один билет":"Please select at least one ticket","Поля, отмеченные звездочкой":"Fields with an asterisk","нужно обязательно заполнить":"are mandatory and must be filled in","Подтверждение приема заявки":"Registration confirmation","Введите имя владельца карты":"Enter cardholder name","Некорректное значение года":"Year is incorrect","Отправить заявку на оплату":"Send payment request","Связаться с техподдержкой":"Contact support","Предпочитаю не указывать":"I prefer not to specify","Оплатите с помощью VKPay":"Pay with VKPay","Часто задаваемые вопросы":"FAQ","Спасибо за использование":"Thank you for using","Или выберите тип билета":"Or select your ticket","Спасибо за регистрацию!":"Thank you for your registration!","Регистрация бесплатна.":"Registration is free","Добавить еще участника":"Add another participant","Выберите способ оплаты":"Choose preferred payment method","Информация о заказчике":"Customer information","включая сервисный сбор":"including service fee","Закончить регистрацию?":"Are you sure you want to close registration form?","Выберите дату и время":"Select date and time","Сначала выберите дату":"Select date first","Промокод неправильный":"Invalid promocode","Связь с техподдержкой":"Support","Перейти к регистрации":"Proceed to registration","Продажа билетов через":"Sell tickets with","Выбрать другое место":"Select another seat","Выберите тип билетов":"Please select your tickets","Вы не выбрали билет!":"Please select a ticket!","и подтверждаете ваше":"and","Закрытие регистрации":"Registration ends","Информация о событии":"Event information","для покупки билетов!":"to buy your tickets.","Загрузка схемы зала":"Hall scheme loading","Изменить выбор мест":"Change seats selection","Выберите тип билета":"Please select your ticket","Стоимость билета — ":"Ticket price is ","Выбрать другую дату":"Select another date","Промокод не подошёл":"Invalid promocode","Введите номер карты":"Enter card number","Имя держателя карты":"Cardholer name","Показать информацию":"Contact information","Для коллег и друзей":"For friends and coworkers","Зарегистрироваться":"Register","Выбрано %s билетов":"%s tickets selected","Добавить участника":"Add participant","Ваш платеж защищен":"This is an SSL-encrypted payment. You're safe.","Как оплатить билет":"How to pay for a ticket","Как получить билет":"How to receive a ticket","Категории билетов":"Ticket types","Выбраны %s билета":"%s tickets selected","Создано с помощью":"Powered by","Укажите год/месяц":"Select year/month","Как вернуть билет":"How to return a ticket","Перейти к заказу":"Proceed","E-mail заказчика":"Customer e-mail","Введите промокод":"Enter promocode","Промокод подошёл":"Promocode accepted","Заполнить анкеты":"Fill the profiles","Узнать подробнее":"Learn more","Выбран %s билет":"%s ticket selected","Промокод верный":"Promocode accepted","Зарезервировано":"Reserved","Оплатите картой":"Payment with card","Нет, продолжить":"No, proceed","Оплата успешна!":"Payment successfull","Выберите места":"Please select your seats","Выберите место":"Please select your seat","Есть промокод?":"I've got a promocode!","Выберите время":"Select time","Оплата участия":"Registration fee","Всего к оплате":"Total amount","Свободных мест":"Vacant spots","Оплата успешна":"Payment successfull","Выберите дату":"Select date","Срок действия":"Expiration date","Сумма платежа":"Total amount","Укажите месяц":"Select month","Нет в продаже":"N/A","Кол&#8209;во":"Quantity","Общая анкета":"Common profile","Организатор":"Organized by","Номер карты":"Card number","Код CVC/CVV":"CVC/CVV code","Укажите год":"Select year","Распечатать":"Print","Это полезно":"It’s good","недоступно":"unavailable","Продолжить":"Proceed","Тип билета":"Ticket type","Количество":"Quantity","от %s руб.":"from %s RUB","Вы выбрали":"Total","Участник №":"Participant","Для работы":"For your job","Применить":"Apply","если есть":"if you have one","бесплатно":"free","Проверить":"Verify","Завершить":"Close","промокод":"Promocode","Промокод":"Promocode","на сумму":"for","Внимание":"Attention","Оплатить":"Pay","Название":"Name","Для себя":"For yourself","Заказать":"Order","билетов":"tickets","Фамилия":"Last name","%s руб.":"%s RUB","Телефон":"Phone","Удалить":"Delete","Купить":"Buy","билета":"tickets","билеты":"tickets","Кол-во":"Quantity","Кол‑во":"Quantity","рублей":"roubles","Сектор":"Sector","сектор":"sector","Наверх":"Back to top","билет":"ticket"," руб.":" RUB","Время":"Time","Сумма":"Total","Место":"Place","место":"place","Адрес":"Location","Билет":"ticket","Далее":"Continue","Назад":"Back","Цена":"Price","руб.":"RUB","Дата":"Date","Стол":"Table","стол":"table","Имя":"First name","Ряд":"Row","ряд":"row"};
window.TWF2.WidgetPrototypes.event_register.prototype._tpls._ank='<div class="b-registration__section b-registration__section_indent section-ank js-section-ank"> {{#event.uses_order_email}} <div class="row-fluid"> <div class="control-group b-reg-row" data-formname="order_mail"> <label class="b-unit__text b-registration__question"> E-mail заказчика <span class="b-registration__question_mandatory">*</span> </label> <div class="b-input-block i-question-control"> <input type="text" name="order_mail" class="span12 b-input" autocomplete="nein" value="{{{prefill.order.order_mail}}}"> </div> </div> </div> {{/event.uses_order_email}} {{#event.has_master_questions}} <div class="b-attendee-divide"> {{#event.master_questions}} {{> _question}} {{/event.master_questions}} </div> {{/event.has_master_questions}} <div class="b-attendees"> {{#attendees}} {{> _attendee_form}} {{/attendees}} </div> {{#event.uses_multiank}} {{#event.has_active_regular_tickets}} <div class="b-multiank-attendee"> <span class="b-add-attendee hide"> <div class="b-add-attendee-wrap"> {{#event.uses_ticket_choice}} <span class="add-attendee-re"> {{> _re_selector}} </span> {{/event.uses_ticket_choice}} <a href="#" class="add-attendee">Добавить участника</a> </div> </span> </div> {{/event.has_active_regular_tickets}} {{/event.uses_multiank}} </div> <div class="b-registration__section section-submit b-registration__section_indent"> <div class="b-registration__check"> {{#event.uses_subscribe}} <div class="b-registration__check-block"> <label class="b-registration__accept"> <input type="checkbox" name="subscribe" checked="checked"> <span>Я хочу получать анонсы событий этого организатора по электронной почте</span> </label> </div> {{/event.uses_subscribe}} {{#event.uses_digest}} <div class="b-registration__check-block"> <label class="b-registration__accept"> <input type="checkbox" name="subscribe_digest" checked="checked"> <span>Хочу получать рекомендации интересных событий от TimePad</span> </label> </div> {{/event.uses_digest}} </div> <div class="b-registration__check" data-formname="accepted_terms"> <div class="b-registration__check-block i-question-control"> <label class="b-registration__accept"> <input type="checkbox" name="accepted_terms"> {{!АХТУНГ! Кусок стринга локализуется вместе со ссылкой, с «Я подтверждаю» по одинокое «и». Если меняете ссылку, не забудьте подправить `../locales/en.yaml`}} <span>Я подтверждаю свое согласие с условиями <a href="{{event.domain}}/org/user_agreement" target="_blank">Пользовательского соглашения</a> и <a href="{{event.domain}}event/oferta/{{event.id}}" target="_blank">Договором оказания услуг по организации мероприятия и политикой возвратов</a><span class="b-registration__question_mandatory">*</span></span> </label> </div> </div> {{#event.uses_processing_personal_data}} {{> _covid_terms}} {{/event.uses_processing_personal_data}} </div> {{#event.uses_charity}} <div class="b-registration__section b-registration__section_lg b-registration__section_indent b-charity js-charity"> <div class="b-card"> <div class="b-card__c"> <div class="l-flex"> <div class="l-flex__1"> <label class="b-card_checkbox"> <input type="checkbox" name="charity_accept" class="js-charity-checkbox" value="1"> Участвовать в благотворительной программе </label> </div> <div class="l-flex__0"> <a href="#" class="b-charity__expand js-charity-show">Подробнее</a> </div> <div class="l-flex__0"> <a href="#" class="b-charity__expand js-charity-hide b-charity__expand_muted hide">Скрыть</a> </div> </div> <div class="b-charity__info js-charity-info hide"> <p class="b-charity__info-text"> Благотворительный фонд «Свет в руках» оказывает психологическую помощь семьям при потере беременности или новорожденного ребенка. Многим родителям эта поддержка дает возможность жить дальше, а также снова решиться на рождение ребенка. </p> <div class="b-charity__amount" data-formname="charity_amount"> <label for="charity-amount" class="i-question-control"> Сумма благотворительного взноса: <input type="number" class="b-input b-charity__amount-input js-charity-amount" name="charity_amount" value="{{event.charity_amount.default}}" min="{{event.charity_amount.min}}"> <span class="b-charity__amount-input-append">рублей</span> </label> </div> <p class="b-charity__disclaimer"> Участвуя в благотворительной программе, я подтверждаю свое согласие с условиями <a href="//timepad.ru/upload/docs/SvetVRukah_donation.pdf" target="_blank">Договора благотворительного пожертвования</a> </p> <p class="b-charity__disclaimer"> Каждый перечисленный вами рубль имеет значение. Timepad не получает прибыли с суммы благотворительного взноса. </p> </div> </div> </div> </div> {{/event.uses_charity}} <div class="b-registration__section section-submit b-registration__section_indent js-section-submit"> <button class="b-pro-wiget__reg-button" name="submit_register" id="eventreg_submit">Зарегистрироваться</button> {{> _button_terms_popup}} {{#event.uses_acquirings}} <div class="b-registration__acquirings b-acquirings js-acquirings"> {{#show_vkpay_button}} <img class="b-acquirings__vkpay" src="{{host}}img/twf2/acquirings/vkpay.png"> {{/show_vkpay_button}} {{#event.acquirings}} <img class="b-acquirings__{{.}}" src="{{host}}img/twf2/acquirings/{{.}}.png"> {{/event.acquirings}} </div> {{/event.uses_acquirings}} \x3c!--p class="b-registration__terms"> Поля, отмеченные звездочкой (<span class="b-registration__question_mandatory">*</span>), нужно обязательно заполнить </p--\x3e </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._attendee_form='<div class="b-attendee b-attendee-{{num}} {{#isFirst}}b-attendee-main{{/isFirst}} {{#event.uses_multiank}}b-attendee-divide{{/event.uses_multiank}}"> {{#event.uses_multiank}} <div class="b-multiank-attendee"> <div class="b-registration__question-number" {{#isSeated}}style="background-color: {{seatedInfo.cat.color}};"{{/isSeated}}> Участник №{{displayNum}} </div> {{#event.uses_ticket_choice}} <span class="change-attendee-re" data-attendee-num="{{num}}"> {{^isSeated}} {{> _re_selector}} {{/isSeated}} {{#isSeated}} <select class="attendee-re" disabled="disabled"> <option value="{{seatedInfo.cat.id}}" class="attendee-re-option-{{seatedInfo.cat.id}}"> {{seatedInfo.cat.name}} {{#seatedInfo.placeHuman}}({{seatedInfo.placeHuman}}){{/seatedInfo.placeHuman}} </option> </select> {{/isSeated}} </span> {{/event.uses_ticket_choice}} {{#deletable}} <a href="#" class="remove-attendee">Удалить</a> {{/deletable}} </div> {{/event.uses_multiank}} {{#questionsSet}} {{> _question}} {{/questionsSet}} </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._banner_diploma='<article class="b-diploma row-fluid"> <section class="b-diploma__description"> <h2>Закажите электронный диплом Timepad</h2> <span class="b-diploma__title-subtext">подтверждающий Вашу регистрацию на это мероприятие</span> <div class="b-diploma__mobile-cert"> <div class="b-diploma__preview"> <img src="/img/diploma-banner/1.png" alt="certificate image"> <img class="ani-diploma-img-2" src="/img/diploma-banner/2.png" alt="certificate image"> <img class="ani-diploma-img-3" src="/img/diploma-banner/3.png" alt="certificate image"> <img class="ani-diploma-img-4" src="/img/diploma-banner/4.png" alt="certificate image"> <img class="ani-diploma-img-5" src="/img/diploma-banner/5.png" alt="certificate image"> </div> </div> <div class="b-diploma__profs"> <h3>Это полезно:</h3> <p><span><svg width="15" height="31" viewBox="0 0 47 94" xmlns="http://www.w3.org/2000/svg"><path d="M32 28.5c0-.907-.15-1.8-.449-2.656-.258-.743-1.106-1.147-1.893-.903-.787.244-1.215 1.044-.957 1.788.198.569.299 1.165.299 1.771 0 3.125-2.692 5.667-6 5.667s-6-2.542-6-5.667 2.692-5.667 6-5.667c.71 0 1.404.116 2.063.344.778.269 1.639-.109 1.924-.844.285-.734-.115-1.548-.893-1.817A9.453 9.453 0 0 0 23 20c-4.963 0-9 3.813-9 8.5 0 4.687 4.037 8.5 9 8.5s9-3.813 9-8.5z" fill="#fff"/><g><path d="M44.063 88.995l-12.7-12.703c3.218-4.123 5.814-8.878 7.697-14.05 2.067 1.697 5.002 4.788 5.002 7.894zm-19.089-10V60.219a1.469 1.469 0 0 0-2.938 0v18.776a41.456 41.456 0 0 1-3.12-3.325 1.466 1.466 0 0 0-.349-.424C11.442 66.541 7.344 54.598 7.344 41.86c0-15.445 6.02-29.725 16.161-38.476 10.14 8.751 16.161 23.03 16.161 38.476 0 12.74-4.098 24.682-11.223 33.387a1.444 1.444 0 0 0-.35.424 41.424 41.424 0 0 1-3.119 3.325zm-22.037 10v-18.86c0-2.344 1.656-4.59 3.045-6.062a21.261 21.261 0 0 1 1.962-1.822c1.882 5.168 4.477 9.92 7.692 14.041zm40.17-26.988a24.61 24.61 0 0 0-3.065-2.715c1.664-5.49 2.552-11.378 2.552-17.433 0-16.786-6.792-32.312-18.17-41.531a1.468 1.468 0 0 0-1.849 0C11.198 9.547 4.406 25.073 4.406 41.859c0 6.055.888 11.943 2.552 17.433a24.609 24.609 0 0 0-3.066 2.715C1.31 64.725 0 67.459 0 70.133V92.53a1.469 1.469 0 0 0 2.507 1.039l15.016-15.016a43.23 43.23 0 0 0 4.508 4.38v9.413a1.469 1.469 0 0 0 2.938 0v-9.412a43.25 43.25 0 0 0 4.508-4.381L44.493 93.57A1.468 1.468 0 0 0 47 92.53V70.133c0-2.674-1.31-5.408-3.892-8.126z" fill="#fff"/></g></svg></span> <b>Для работы:</b> диплом усилит Ваше резюме и поможет карьерному росту</p> <p> <span><svg width="31" height="31" viewBox="0 0 94 94" xmlns="http://www.w3.org/2000/svg"><path d="M90.328 52.753c0 7.754-6.287 14.063-14.014 14.063h-3.125a38.54 38.54 0 0 0 1.567-3.685h1.558c5.703 0 10.342-4.655 10.342-10.378V46.95a1.84 1.84 0 0 0-1.836-1.843h-7.71v-3.684h13.218zm-13.22-2.951v-1.013h5.866v3.96c0 3.689-2.988 6.69-6.66 6.69h-.417c.8-3.131 1.21-6.37 1.21-9.637zm.535 33.885c-.84 3.789-4.218 6.63-8.245 6.63h-57.28c-4.027 0-7.404-2.841-8.245-6.63zM92.164 37.74H77.11v-3.898A1.839 1.839 0 0 0 75.273 32H35.617a1.839 1.839 0 0 0-1.836 1.842c0 1.017.822 1.841 1.836 1.841h37.82v14.119c0 12.403-6.601 23.93-17.26 30.202H20.932c-10.66-6.272-17.261-17.8-17.261-30.202V35.683h12.3a1.839 1.839 0 0 0 1.837-1.841A1.839 1.839 0 0 0 15.973 32H1.836A1.839 1.839 0 0 0 0 33.842v15.96a38.715 38.715 0 0 0 5.394 19.739 38.844 38.844 0 0 0 9.085 10.463H1.836A1.839 1.839 0 0 0 0 81.846C0 88.548 5.436 94 12.117 94h57.281c6.682 0 12.118-5.452 12.118-12.154a1.839 1.839 0 0 0-1.836-1.842H62.63a38.855 38.855 0 0 0 8.502-9.515h5.182C86.066 70.49 94 62.531 94 52.75V39.58a1.839 1.839 0 0 0-1.836-1.841z" fill="#fff"/><path d="M40.782 9.962l-.971-1.176a4.56 4.56 0 0 1-.006-5.867A1.756 1.756 0 0 0 39.504.39c-.808-.618-1.983-.488-2.624.291-2.51 3.049-2.506 7.304.01 10.348l.97 1.176c1.865 2.255 1.867 5.408.008 7.667l-.996 1.209a1.756 1.756 0 0 0 .302 2.529c.343.262.753.39 1.16.39.55 0 1.094-.233 1.463-.681l.996-1.21c2.947-3.578 2.942-8.573-.01-12.147z" fill="#fff"/><path d="M50.782 13.962l-.971-1.176a4.56 4.56 0 0 1-.005-5.867 1.756 1.756 0 0 0-.302-2.529c-.808-.618-1.983-.487-2.624.291-2.51 3.049-2.506 7.304.01 10.348l.97 1.176c1.865 2.256 1.867 5.408.007 7.667l-.995 1.21a1.756 1.756 0 0 0 .302 2.528c.343.263.753.39 1.16.39.55 0 1.095-.233 1.463-.681l.996-1.21c2.947-3.578 2.942-8.573-.01-12.147z" fill="#fff"/><path d="M29.782 13.962l-.971-1.176a4.56 4.56 0 0 1-.006-5.867 1.756 1.756 0 0 0-.301-2.529c-.808-.618-1.983-.487-2.624.291-2.51 3.048-2.506 7.304.01 10.348l.97 1.176c1.865 2.255 1.867 5.408.008 7.667l-.996 1.209a1.756 1.756 0 0 0 .301 2.529c.344.262.753.39 1.16.39.55 0 1.095-.233 1.464-.68l.996-1.21c2.947-3.579 2.942-8.574-.01-12.148z" fill="#fff"/><g><path d="M27.414 32.586A2.015 2.015 0 0 0 26 32c-.526 0-1.042.214-1.414.586A2.02 2.02 0 0 0 24 34c0 .526.214 1.042.586 1.416.372.372.888.584 1.414.584.526 0 1.042-.212 1.414-.584.374-.374.586-.888.586-1.416 0-.526-.212-1.042-.586-1.414z" fill="#fff"/></g><g><path d="M66.131 48c-1.032 0-1.869.81-1.869 1.81 0 6.715-2.814 13.315-7.72 18.107a1.769 1.769 0 0 0 .011 2.559c.365.35.84.524 1.316.524.481 0 .962-.179 1.328-.536C64.79 65 68 57.472 68 49.81 68 48.81 67.163 48 66.131 48z" fill="#fff"/></g><g><path d="M53.745 73.011a1.972 1.972 0 0 0-2.694-.754l-.045.025a1.992 1.992 0 0 0-.75 2.707 1.975 1.975 0 0 0 2.693.754l.045-.025a1.992 1.992 0 0 0 .75-2.707z" fill="#fff"/></g></svg></span> <b>Для себя:</b> мероприятие пройдет, а диплом останется у вас навсегда</p> <p> <span><svg width="31" height="31" viewBox="0 0 94 94" xmlns="http://www.w3.org/2000/svg"><path d="M10.956 53.428h6.261V64.43c0 .867.701 1.571 1.566 1.571.415 0 .813-.166 1.106-.46l12.063-12.112h2.483v-3.142h-3.13c-.416 0-.814.166-1.107.46l-9.85 9.89v-8.779c0-.868-.7-1.571-1.565-1.571h-7.827c-4.32-.005-7.82-3.52-7.825-7.858V11c.005-4.337 3.506-7.852 7.825-7.857h50.088c4.32.005 7.82 3.52 7.825 7.857v23.572H72V11C71.993 4.928 67.092.006 61.043 0H10.956C4.908.006.007 4.928 0 11v31.428c.007 6.073 4.908 10.994 10.956 11z" fill="#fff"/><path d="M90.89 70.667a7.787 7.787 0 0 1-7.779 7.778h-4.666c-.86 0-1.556.696-1.556 1.555v8.69L67.1 78.9A1.555 1.555 0 0 0 66 78.445H48.89a7.787 7.787 0 0 1-7.779-7.778V48.889a7.787 7.787 0 0 1 7.778-7.778h34.222a7.786 7.786 0 0 1 7.778 7.778v21.778zM48.89 38c-6.012.007-10.883 4.878-10.89 10.889v21.778c.007 6.011 4.878 10.882 10.89 10.89h16.466l11.989 11.987a1.556 1.556 0 0 0 2.655-1.1V81.557h3.111c6.011-.007 10.882-4.878 10.889-10.89V48.89C93.993 42.878 89.122 38.007 83.111 38z" fill="#fff"/><path d="M13 12h31v3H13z" fill="#fff"/><path d="M50 12h9v3h-9z" fill="#fff"/><path d="M12 22h47v3H12z" fill="#fff"/><path d="M34 31h25v3H34z" fill="#fff"/><g><path d="M13 31h16v3H13z" fill="#fff"/></g><g><path d="M13 41h22v3H13z" fill="#fff"/></g><g><path d="M47 49h22v3H47z" fill="#fff"/></g><g><path d="M75 49h9v3h-9z" fill="#fff"/></g><g><path d="M47 58h38v3H47z" fill="#fff"/></g><g><path d="M47 67h38v3H47z" fill="#fff"/></g></svg></span> <b>Для коллег и друзей:</b> поделитесь Вашими достижениями с близкими</p> </div> <a href="{{order.diploma_url}}" target="_blank" type="button">Заказать</a> </section> <aside class="b-diploma__offer"> <div class="b-diploma__offer-container"> <div class="b-diploma__preview"> <img src="/img/diploma-banner/1.png" alt="certificate image"> <img class="ani-diploma-img-2" src="/img/diploma-banner/2.png" alt="certificate image"> <img class="ani-diploma-img-3" src="/img/diploma-banner/3.png" alt="certificate image"> <img class="ani-diploma-img-4" src="/img/diploma-banner/4.png" alt="certificate image"> <img class="ani-diploma-img-5" src="/img/diploma-banner/5.png" alt="certificate image"> </div> <p class="b-diploma__x-price"><span>{{order.diploma_price_without_discount}} руб.</span></p> <p class="b-diploma__price">{{order.diploma_price}} руб.</p> </div> </aside> </article> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._banner_flocktory="{{! этот файл тут, чтобы кастомы не крашились. даже если какой-то старый кастом соберёт флоктори из ассетов, он не отобразится, флоктори выпилен в TP-11200 }}",window.TWF2.WidgetPrototypes.event_register.prototype._tpls._banner_kinopoisk=' <div class="i-kinopoisk b-kinopoisk"> <a class="b-kinopoisk__link" target="_blank" href="https://www.kinopoisk.ru/gift/?promocode={{{order.kinopoisk_code}}}&utm_source=timepad&utm_medium=paid_cpa&utm_campaign=tickets&source=kinopoisk_paid_cpa_timepad_tickets"> <div class="b-kinopoisk__banner"> <img src="/img/kinopoisk-banner-736х160.png" alt="banner-kinopoisk" class="b-kinopoisk__img b-kinopoisk__img_hidden--mobile"> <img src="/img/kinopoisk-banner-488х612.png" alt="banner-kinopoisk" class="b-kinopoisk__img b-kinopoisk__img_hidden--desktop"> <div class="b-kinopoisk__promocode">{{{order.kinopoisk_code}}}</div> </div> </a> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._branding='<div class="twf2-branding"> <a href="http://timepad.ru/?utm_medium=logo&utm_source=widgetFooter&utm_campaign=internalServicePromo&utm_content=event_register" target="_blank"> Продажа билетов через <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-i-tp-logo_v2" data-svoge-class="svg-i-tp-logo_v2 er er_branding er-faded"> </a> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls["_branding.thanks"]='<div class="twf2-branding"> <a href="http://timepad.ru/?utm_medium=logo&utm_source=widgetFooter&utm_campaign=internalServicePromo&utm_content=event_register" target="_blank"> Спасибо за использование <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-i-tp-logo_v2" data-svoge-class="svg-i-tp-logo_v2 er er_branding-thanks er-faded"> для покупки билетов! </a> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._button_terms_popup='<div class="b-registration__section"> <div class="b-pro-widget__terms-popup b-pro-widget__terms-popup_hidden js-pro-widget-terms-popup"> Необходимо подтвердить согласие с условиями и договором <div class="b-pro-widget__terms-popup-arrow"></div> </div> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._charity_ok_text='<p class="l-unit"> <b>Оплата благотворительного взноса прошла успешно.</b> </p> <p class="l-unit"> Спасибо, что вы помогли благотворительному фонду «Свет в руках». Дальше мы переведем средства фонду, и это поможет многим семьям пережить утрату и обрести свой путь к новому родительству. </p> <p class="l-unit"> Мы направили вам на почту благодарственное письмо с дополнительной информацией. </p>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._closing_confirmation='<div class="twf-popup-closing-confirmation"> <div class="confirmation-tint"></div> <div class="confirmation-cont"> <div class="confirmation-title">{{title}}</div> <div class="confirmation-description">{{description}}</div> <div class="confirmation-btns"> <a href="#" class="b-pro-wiget__button confirmation-btn__proceed">{{proceed}}</a> <a href="#" class="b-pro-widget__default-btn confirmation-btn__close">{{close}}</a> </div> </div> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._cloudpay='<div class="b-registration__section b-plastic-card-block"> <form id="widget_pay" class="b-plastic-card" action="post"> <input type="hidden" data-cp="expDateMonthYear" value=""> <h5 class="b-unit__header_size_small b-registration__header"> Оплатите картой: </h5> <div class="b-plastic-card-info"> <div class="b-plastic-card-info__side_front"> <label for="card-number" class="b-plastic-card-info__label">Номер карты</label> <input type="text" id="card-number" data-cp="cardNumber" class="b-plastic-card-info__input b-plastic-card-info__input_width_full" required> <div class="b-plastic-card-info__validity"> <label for="card-validity-month" class="b-plastic-card-info__label b-plastic-card-info__label_float_left b-plastic-card-info__label_line_height_3">Срок действия</label> <select id="card-validity-month" name="card-validity-month" class="b-plastic-card-info__validity-select" required> <option value="01">01</option> <option value="02">02</option> <option value="03">03</option> <option value="04">04</option> <option value="05">05</option> <option value="06">06</option> <option value="07">07</option> <option value="08">08</option> <option value="09">09</option> <option value="10">10</option> <option value="11">11</option> <option value="12">12</option> </select> <span class="b-plastic-card-info__slash">/</span> <select id="card-validity-year" name="card-validity-year" class="b-plastic-card-info__validity-select" required></select> </div> <label for="card-name" class="b-plastic-card-info__label b-plastic-card-info__label_mobile">Имя держателя карты</label> <input id="card-name" type="name" name="name" class="b-plastic-card-info__input b-plastic-card-info__input_width_full" placeholder="IVANOV IVAN" autocomplete="nein" required> <div class="b-plastic-card-info__caption">Латинские буквы, как на карте</div> </div> <div class="b-plastic-card-info__side_back"> <label for="card-cvc" class="b-plastic-card-info__label">Код CVC/CVV</label> <input type="text" id="card-cvc" data-cp="cvv" class="b-plastic-card-info__input b-plastic-card-info__input_width_small" maxlength="3" required> <div class="b-plastic-card-info__caption b-plastic-card-info__caption_color_dark">Три последние цифры с оборота карты</div> </div> </div> <ul id="pay_errors"></ul> <div class="b-plastic-card-info__submit-block"> <button type="submit" class="b-pro-wiget__pay-button b-plastic-card-info__button-submit">Оплатить</button> <div class="b-plastic-card-info__secure-block"> <span>Ваш платеж защищен</span> </div> <div class="b-plastic-card-info__secure-logos"> <img src="{{host}}img/cloudpayments/visa.png" alt="Verified by Visa" width="46px" height="20px"/> <img src="{{host}}img/cloudpayments/mastercard.png" alt="MasterCard SecureCode" width="56px" height="20px"/> <img src="{{host}}img/cloudpayments/pcidss.png" alt="PCI DSS" width="52px" height="20px"/> </div> </div> </form> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._covid_terms='<div class="b-registration__accept-covid"> <div class="b-registration__warn-info">! В связи с угрозой распространения в городе Москве новой коронавирусной инфекции (2019-nCov) гражданам: старше 65 лет, имеющими определенные заболевания, контактировавшими с заболевшими 2019-nCov ограничивается посещение выставок, спектаклей и других культурно-досуговых мероприятий</div> <div class="b-registration__warn-info b-registration__warn-info_small">Подтверждаю, что у меня и всех, для кого я приобретаю билеты:</div> </div> <div class="b-registration__check" data-formname="accepted_terms_age"> <div class="b-registration__check-block i-question-control"> <label class="b-registration__accept"> <input type="checkbox" name="accepted_terms_age"> <span> Возраст на момент проведения мероприятия менее 65 <nobr>лет. <span class="b-registration__question_mandatory">*</span></nobr> </span> </label> </div> </div> <div class="b-registration__check" data-formname="accepted_terms_illness"> <div class="b-registration__check-block i-question-control"> <label class="b-registration__accept"> <input type="checkbox" name="accepted_terms_illness"> <span> Отсутствуют заболевания, <a href="https://mosgorzdrav.ru/ru-RU/news/default/card/4689.html" target="_blank">перечень*</a> которых определен Департаментом здравоохранения города Москвы, при которых не допускается покидать место проживания (пребывания) в условиях действия режима повышенной готовности в <nobr>Москве. <span class="b-registration__question_mandatory">*</span></nobr> </span> </label> </div> </div> <div class="b-registration__check" data-formname="accepted_terms_virus"> <div class="b-registration__check-block i-question-control"> <label class="b-registration__accept"> <input type="checkbox" name="accepted_terms_virus"> <span> Отсутствуют подозрения на наличие новой коронавирусной инфекции (2019-nCoV), а также проявления острой респираторной вирусной инфекции и других острых респираторных <nobr>заболеваний. <span class="b-registration__question_mandatory">*</span></nobr> </span> </label> </div> </div> <div class="b-registration__check" data-formname="accepted_terms_contacts"> <div class="b-registration__check-block i-question-control"> <label class="b-registration__accept"> <input type="checkbox" name="accepted_terms_contacts"> <span> Отсутствуют контакты с гражданами, у которых выявлено наличие новой коронавирусной инфекции <nobr>(2019-nCoV) <span class="b-registration__question_mandatory">*</span></nobr> </span> </label> </div> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._covid_users_anks='<form id="additional_covid_form" action="{{event_domain}}event/widget_covid_register/{{event_id}}"> <div class="b-registration__section b-registration__section_no-bottom-space"> <div class="b-registration__error hide"></div> </div> <div class="row-fluid"> <div class="control-group b-reg-row" data-formname="order_mail"> <label class="b-unit__text b-registration__question"> E-mail заказчика <span class="b-registration__question_mandatory">*</span> </label> <div class="b-input-block i-question-control"> <input type="text" name="order_mail" class="span12 b-input" autocomplete="nein" value="{{{prefill.order.order_mail}}}"> </div> </div> </div> <div class="row-fluid"> <div class="control-group b-reg-row" data-formname="order_phone"> <label class="b-unit__text b-registration__question"> Номер телефона заказчика <span class="b-registration__question_mandatory">*</span> </label> <div class="b-input-block i-question-control"> <input type="text" name="order_phone" class="span12 b-input" autocomplete="nein" value="{{{prefill.order.order_phone}}}"> </div> </div> </div> <input type="hidden" name="selected_tickets_count" value="{{selected_tickets_count}}"> <input type="hidden" name="selected_ticket_price" value="{{selected_ticket_price}}"> <div class="b-attendees"> {{#add_ank}} <div class="b-registration__question-number">Пожалуйста, введите данные посетителя №{{displayNum}}</div> <div class="b-attendee b-attendee-main b-attendee-divide b-attendee-{{displayNum}}" data-attendee-num="{{num}}"> {{#questions}} <div class="row-fluid"> <div class="control-group b-reg-row" data-formname="{{formname}}" data-tag="{{{tag}}}"> <label class="b-unit__text b-registration__question"> {{{label}}} <span class="b-registration__question_mandatory">*</span> </label> <div class="b-input-block i-question-control"> <input type="text" name="{{formname}}" class="span12 b-input js-covid_question" autocomplete="nein" value="{{{value}}}"> </div> </div> </div> {{/questions}} </div> {{/add_ank}} </div> <div class="b-registration__check" data-formname="accepted_processing_personal_data"> <div class="b-registration__check-block i-question-control"> <label class="b-registration__accept"> <input type="checkbox" name="accepted_processing_personal_data"> <span> Даю согласие ООО "ТаймПэд Лтд" на передачу в обработку органам исполнительной власти города Москвы и подведомственным им организациям, участвующим в обеспечении соблюдения режима повышенной готовности, моих персональных данных с целью контроля соответствия возможности выполнения мной ограничений, введенных указом Мэра Москвы от 06.10.2020 № 97-УМ и связанных с режимом повышенной готовности в условиях распространения COVID-19, в том числе в/до момента посещения мною соответствующего мероприятия (использования <nobr>билета). <span class="b-registration__question_mandatory">*</span></nobr> </span> </label> </div> </div> <button type="submit" class="b-pro-wiget__send-covid-data-button disabled">Продолжить</button> <div class="b-registration__section"> <div class="b-pro-widget__terms-popup b-pro-widget__terms-popup_hidden js-pro-widget-covid-terms-popup"> Необходимо дать согласие на передачу и обработку персоональных данных <div class="b-pro-widget__terms-popup-arrow"></div> </div> </div> </form> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._errorBlock='<div class="b-error-block"> <div class="b-error"> <div class="b-error__arrow-block"></div> <span>{{{errorText}}}</span> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._event='<div class="b-event js-section-event"> {{#event.image}} <div class="b-event__pic" style="background-image: url(\'{{event.image}}\');"></div> {{/event.image}} <h5 class="b-unit__header_size_small b-event__header"> {{{event.name}}} </h5> <div class="b-event__info"> {{#event.place}} <div class="row-fluid b-event__info-elem"> <div class="span3 b-unit__text_size_small b-unit__text_color_gray"> Место: </div> <div class="span9"> <span class="b-unit__text_size_small b-unit__text_color_black"> {{#event.city}}{{{event.city}}}, {{/event.city}} {{{event.place}}} </span> </div> </div> {{/event.place}} <div class="row-fluid b-event__info-elem"> <div class="span3 b-unit__text_size_small b-unit__text_color_gray"> Организатор: </div> <div class="span9"> <span class="b-unit__text_size_small b-unit__text_color_black"> {{{event.organization_name}}} </span> </div> </div> <div class="row-fluid b-event__info-elem"> <div class="span3 b-unit__text_size_small b-unit__text_color_gray"> Время: </div> <div class="span9"> <span class="b-unit__text_size_small b-unit__text_color_black"> {{event.datetime}} </span> </div> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._faq='<p class="b-unit__text b-unit__text_color_gray">Часто задаваемые вопросы</p> <ul id="widget_faq"> <li><a target="_blank" href="http://help.timepad.ru/5588/{{#event.locale_ru}}80128{{/event.locale_ru}}{{^event.locale_ru}}334588{{/event.locale_ru}}">Как оплатить билет?</a></li> <li><a target="_blank" href="http://help.timepad.ru/5588/{{#event.locale_ru}}80127{{/event.locale_ru}}{{^event.locale_ru}}334590{{/event.locale_ru}}">Как получить билет?</a></li> <li><a target="_blank" href="http://help.timepad.ru/5588/{{#event.locale_ru}}take_money_back_to_me{{/event.locale_ru}}{{^event.locale_ru}}334591{{/event.locale_ru}}">Как вернуть билет?</a></li> </ul> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._footer='<p class="b-registration__footer"> <a href="http://special.timepad.ru/orgnew/?utm_medium=logo&utm_source=widgetFooter&utm_campaign=internalServicePromo&utm_content=event_register" target="_blank"> <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-i-tp-logo_v2" data-svoge-class="svg-i-tp-logo_v2 er er_footer er-faded"> </a> </p> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._header_image='{{#settings.showEventInfoHeaderEverywhere}} <div class="b-payment-poster"> <style> .b-payment__poster:after { background-color: {{event.selective_color}}; } </style> <div class="b-payment__poster" style="background-image: url(\'{{event.image}}\')"> <h1 class="b-payment__poster-header">{{{event.name}}}</h1> <div class="b-payment__event-more"> <p class="b-payment__event-more-text"> <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-twf2-datetime" data-svoge-class="svg-icon svg-icon_little svg-icon_white"> {{{event.date_human}}} </p> {{#event.city}}<p class="b-payment__event-more-text"> <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="svg-twf2-place" data-svoge-class="svg-icon svg-icon_little svg-icon_white"> {{event.city}}{{#event.place}}, {{{event.place}}}{{/event.place}} </p>{{/event.city}} </div> </div> </div> {{/settings.showEventInfoHeaderEverywhere}}',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._order='<div class="b-registration__section b-registration__section_indent"> <h5 class="b-unit__header_size_small b-registration__header"> Вы заказали следующие билеты: </h5> </div> <div class="row-fluid b-reg-table b-reg-table_type_striped b-payment__tickets"> <div> <div class="row-fluid b-reg-table__row b-reg-table__row_header"> <div class="{{#order.payment.id}}span7{{/order.payment.id}} {{^order.payment.id}}span10{{/order.payment.id}} b-reg-table__cell"> <h3 class="b-reg-table__header b-reg-table__text">Тип билета</h3> </div> {{#order.payment.id}} <div class="span3 b-reg-table__cell"> <h3 class="b-reg-table__header b-reg-table__text">Цена</h3> </div> {{/order.payment.id}} <div class="span2 b-reg-table__cell"> <h3 class="b-reg-table__header b-reg-table__text"><span>Кол&#8209;во</span></h3> </div> </div> {{#order.regevents}} <div class="row-fluid b-reg-table__row"> <div class="{{#order.payment.id}}span7{{/order.payment.id}} {{^order.payment.id}}span10{{/order.payment.id}} b-reg-table__cell"> <span class="b-reg-table__text">{{{name}}}</span> </div> {{#order.payment.id}} <div class="span3 b-reg-table__cell"> <span class="b-reg-table__text">{{price_human}}</span> </div> {{/order.payment.id}} <div class="span2 b-reg-table__cell"> <span class="b-reg-table__text">{{tickets}}</span> </div> </div> {{/order.regevents}} {{#order.charity_payment}} <div class="row-fluid b-reg-table__row"> <div class="span7 b-reg-table__cell"> <span class="b-reg-table__text">Благотворительный взнос</span> </div> <div class="span5 b-reg-table__cell"> <span class="b-reg-table__text">{{order.charity_payment.sum}} руб.</span> </div> </div> {{/order.charity_payment}} {{#order.order_only_discount}} <div class="row-fluid b-reg-table__row"> <div class="span7 b-reg-table__cell"> <span class="b-reg-table__text">Скидка на заказ</span> </div> <div class="span5 b-reg-table__cell"> <span class="b-reg-table__text">{{order.order_only_discount_human}}</span> </div> </div> {{/order.order_only_discount}} {{#order.total}} <div class="row-fluid b-reg-table__row"> <div class="span10 b-reg-table__cell"> <span class="b-reg-table__text"> Всего к оплате {{order.total_human}} {{#order.payment.topComission}} (включая сервисный сбор {{order.payment.topComission_human}}) {{/order.payment.topComission}} </span> </div> {{#order.payment.id}} <div class="span2 b-reg-table__cell"> <span class="b-reg-table__text"></span> </div> {{/order.payment.id}} </div> {{/order.total}} </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._policyResult='{{#policyResult.applied_policies}}{{#.}} <div class="row-fluid b-reg-table__row b-reg-table__row_type_promo policyResultRow"> <div class="span12 b-reg-table__cell"> <div class="b-reg-table__text b-input-block__promo-btn-text b-reg-table__text-policy-result">{{.}}</div> </div> </div> {{/.}}{{/policyResult.applied_policies}} {{#policyResult.pricing.order_discount}} <div class="row-fluid b-reg-table__row b-reg-table__row_type_promo policyResultRow policy_order_discount js-policy_order_discount"> <div class="span12 b-reg-table__cell"> <div class="b-reg-table__text b-input-block__promo-btn-text b-reg-table__text-policy-result">Скидка на заказ — {{policyResult.pricing.h_order_discount}}</div> </div> </div> {{/policyResult.pricing.order_discount}}',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._promocodeBlock='{{#event.has_promocode}} {{^hidePromocodeInput}} <form class="b-registration__section b-registration__section_indent b-registration__section_no-bottom-space js-section-promocodeBlock"> <div class="row-fluid {{#event.promocode_wrong}}error{{/event.promocode_wrong}}" id="promoCode" data-formname="promocode"> <div class="control-group b-reg-row"> <label class="b-unit__text b-registration__question"> Промокод{{#ifYouHavePromocode}} (если есть){{/ifYouHavePromocode}} </label> <div class="b-input-block b-input-block_type_promocode {{#lastUserInputtedPromocode}}{{#event.promocode_wrong}}b-input-block_type_promocode-not-success{{/event.promocode_wrong}}{{#event.promocode_ok}}b-input-block_type_promocode-success{{/event.promocode_ok}}{{/lastUserInputtedPromocode}}"> <div class="b-input-block__left-table-cell"> <input type="text" name="promocode" class="span12 b-input b-input_promocode" id="promocodeInput" autocomplete="nein" value="{{lastUserInputtedPromocode}}"> </div> <div class="b-input-block__right-table-cell"> <button type="submit" name="apply_promocode" class="b-input-block__promo-btn"> <span class="b-input-block__promo-btn-text"> {{#lastUserInputtedPromocode}} {{#event.promocode_wrong}} Промокод неправильный {{/event.promocode_wrong}} {{#event.promocode_ok}} Промокод верный {{/event.promocode_ok}} {{/lastUserInputtedPromocode}} {{^lastUserInputtedPromocode}} Применить {{/lastUserInputtedPromocode}} </span> </button> </div> </div> </div> </div> </form> {{/hidePromocodeInput}} {{/event.has_promocode}} ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._question='<div class="row-fluid"> <div class="control-group b-reg-row {{#meta.dadata}}js-dadata{{/meta.dadata}}" data-formname="{{formname}}" data-tag="{{{tag}}}" data-type="{{{type}}}"> <label class="b-unit__text b-registration__question"> {{{name}}} {{#mandatory}}<span class="b-registration__question_mandatory">*</span>{{/mandatory}} </label> {{#text}} <div class="b-input-block i-question-control"> <input type="text" name="{{formname}}" class="span12 b-input" autocomplete="nein" value="{{{value}}}"> </div> {{/text}} {{#bigtext}} <div class="b-input-block i-question-control"> <textarea rows="3" class="span12 b-input b-input_type_textarea" name="{{formname}}" autocomplete="nein">{{{value}}}</textarea> </div> {{/bigtext}} {{#radio}} <div class="b-registration__check-block i-question-control"> {{^meta.radioselect}} {{^mandatory}} <div class="b-input-block"> <label class="b-registration__label"> <input class="b-radio" type="radio" value="0" name="{{formname}}" checked="checked"> <span>Предпочитаю не указывать</span> </label> </div> {{/mandatory}} {{#vars_unfold}} <div class="b-input-block"> <label class="b-registration__label"> <input class="b-radio" type="radio" value="{{num}}" name="{{formname}}" {{#checked}}checked="checked"{{/checked}}> <span>{{text}}</span> </label> </div> {{/vars_unfold}} {{/meta.radioselect}} {{#meta.radioselect}} <div class="b-input-block"> <select name="{{formname}}"> {{^mandatory}} <option value="0">Предпочитаю не указывать</option> {{/mandatory}} {{#vars_unfold}} <option value="{{num}}" {{#checked}}selected="selected"{{/checked}}>{{text}}</option> {{/vars_unfold}} </select> </div> {{/meta.radioselect}} </div> {{/radio}} {{#multivar}} <div class="b-registration__check-block i-question-control"> {{#vars_unfold}} <div class="b-input-block"> <label class="b-registration__label"> <input type="checkbox" class="b-radio" value="{{num}}" value="{{aname}}" name="{{aname}}" {{#checked}}checked="checked"{{/checked}}> <span>{{text}}</span> </label> </div> {{/vars_unfold}} </div> {{/multivar}} {{#upload}} <div class="i-question-control"> <input type="hidden" name="{{formname}}" role="uploadcare-uploader-outer" data-autostore="true" data-public-key="{{event.uc_publickey}}" data-locale="{{event.locale}}" data-tabs="file url dropbox vk" data-images-only="false" data-path-value="true" data-preview-step="false" data-clearable="false" data-multiple="false" data-crop="disabled" /> </div> {{/upload}} {{#phone}} <div class="b-input-block i-question-control"> <input type="text" name="{{formname}}" data-phone-verify="{{formname}}" class="js-tpphone {{#uses_phone_verify}}js-verify-phone{{/uses_phone_verify}} span12 b-input" value="{{{value}}}"> </div> {{/phone}} {{#description}}<span class="help-block b-registration__question_comment">{{{description}}}</span>{{/description}} </div> </div> {{#phone}} {{#uses_phone_verify}} <div class="row-fluid {{^mandatory}}js-verify-block-hideble hide{{/mandatory}}" data-phone-verify="{{formname}}"> <div class="control-group b-reg-row"> <label class="b-unit__text b-registration__question js-verify-label js-verify-label_nophone">Подтверждение телефона</label> <div class="twf2-danger-plate js-verify-info js-verify-info-danger twf2-unit" data-phone-verify="{{formname}}" style="display: none;"></div> <button class="b-pro-wiget__button b-pro-widget__small-button js-verify-btn" disabled="disabled" type="button" data-phone-verify="{{formname}}">Выслать код по SMS</button> <label class="b-unit__text b-registration__question js-verify-label" style="display: none;">Код подтверждения</label> <div class="twf2-warning-plate js-verify-info js-verify-info-warning twf2-unit" data-phone-verify="{{formname}}" style="display: none;"> На указанный номер выслан код. Введите этот код для подтверждения вашего телефона. Если по каким-либо причинам код не пришел, отправить новый код можно по ссылке ниже. </div> <div class="twf2-success-plate js-verify-info js-verify-info-success twf2-unit" data-phone-verify="{{formname}}" style="display: none;"> Код верный! Ваш телефон подтвержден, спасибо :) </div> <input type="text" name="{{phone_verify_formname}}" class="span12 b-input js-verify-code" autocomplete="nein" value="" style="display: none" data-phone-verify="{{formname}}"> <span class="help-block b-registration__question_comment js-verify-desc js-verify-desc_nophone" data-phone-verify="{{formname}}">Сначала неообходимо ввести телефон</span> <span class="help-block b-registration__question_comment js-verify-desc js-verify-desc_preresend" data-phone-verify="{{formname}}" style="display: none;">Повторно отправить код можно будет через <span class="js-verify-timer">00:00</span></span> <a href="#" class="help-block b-registration__question_comment js-verify-desc js-verify-desc_resend js-verify-resend" data-phone-verify="{{formname}}" style="display: none;">Отправить код еще раз</a> </div> </div> {{/uses_phone_verify}} {{/phone}}',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._re_selector='<select class="attendee-re js-section-re_selector"> {{#event.tickets}} <option value="{{id}}" class="attendee-re-option-{{id}}">{{{name}}} ({{h_price}})</option> {{/event.tickets}} </select>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._registrant='<h5 class="b-unit__header_size_small b-registration__header"> Информация о заказчике </h5> <div class="b-event__info"> {{^event.uses_order_email}} <div class="row-fluid b-event__info-elem"> <div class="span2"> <span class="b-unit__text b-unit__text_color_gray"> Имя: </span> </div> <div class="span6"> <span class="b-unit__text b-unit__text_color_black"> {{{order.registration.firstname}}} {{{order.registration.surname}}} </span> </div> </div> {{/event.uses_order_email}} <div class="row-fluid b-event__info-elem"> <div class="span2"> <span class="b-unit__text b-unit__text_color_gray"> E-mail: </span> </div> <div class="span6"> <span class="b-unit__text b-unit__text_color_black"> {{order.email}} </span> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._seat_info='<div class="row-fluid b-reg-table__row b-reg-table__row_fluid" id="seat_cont_{{place.id}}"> <div class="span9 b-reg-table__cell"> <div class="b-reg-table__text">{{cat.name}}</div> <div class="help-block b-reg-table__category-description">{{placeHuman}}</div> </div> <div class="span3 b-reg-table__cell"> <div class="b-reg-table__text">{{cat.price}} руб.</div> </div> <span class="close">×</span> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._seatcheck='<h5 class="b-unit__header_size_small b-registration__header schk__widget-header"> {{#event.uses_multireg}} Выберите места: {{/event.uses_multireg}} {{^event.uses_multireg}} Выберите место: {{/event.uses_multireg}} </h5> {{#event.uses_preloader}} <div class="schk-wrap"> <div class="schk-loader"> <div class="schk-loader__text">Загрузка схемы зала</div> </div> <div class="schk-tooltip schk-tooltip_preloader" style="opacity:0;"> <p class="schk-tooltip__row"></p> </div> </div> {{/event.uses_preloader}} {{^event.uses_preloader}} <div class="schk-wrap__cover"> <div class="schk-loader"> <div class="schk-loader__text">Загрузка схемы зала</div> </div> <div class="schk-fixator"> <div class="schk-wrap schk-wrap_bounded"> </div> </div> <div class="schk-wrap__cover-btn-wrap js-schk-wrap__cover-btn-wrap" style="display: none;"> <div class="schk-wrap__cover-btn-bg"> <a class="ep3-like-btn ep3-like-btn_static js-schk-wrap__cover-btn" href="#"> {{#event.uses_multireg}} Выберите места на схеме зала {{/event.uses_multireg}} {{^event.uses_multireg}} Выберите место на схеме зала {{/event.uses_multireg}} </a> </div> </div> <div class="schk-wrap_preview js-schk-wrap_preview"></div> </div> {{/event.uses_preloader}} <div class="b-registration__section" style="display: none;"> <div class="row-fluid b-reg-table b-reg-table_without-header" id="places_list"> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._seatcheck_modal='<div class="schk-modal"> {{#event.uses_preloader}} <div class="schk-loader schk-loader_full"> <div class="schk-loader__text">Загрузка схемы зала</div> </div> {{/event.uses_preloader}} <div class="schk-modal__scheme-wrap"> <div class="schk-modal__scheme"> <div class="schk-scheme__header"> <div class="schk-scheme__header-text"> {{#event.uses_multireg}} Выберите места на схеме зала {{/event.uses_multireg}} {{^event.uses_multireg}} Выберите место на схеме зала {{/event.uses_multireg}} </div> </div> <div class="schk-scheme__scheme"> {{#event.uses_preloader}} <div class="schk-wrap schk-wrap_stretched"></div> {{/event.uses_preloader}} </div> <div class="schk-scheme__footer"> <div class="schk-scheme__back-btn"> <a href="#" class="ep3-like-btn ep3-like-btn_brand-info js-proceed-btn">Назад</a> </div> <div class="schk-scheme__selected-num"></div> <div class="schk-scheme__proceed-btn"> <a href="#" class="ep3-like-btn js-proceed-btn">К заказу</a> </div> </div> </div> </div> <div class="schk-modal__zoom-wrap"> <div class="schk-modal__zoom"> <div class="zoom__round-btn js-schk-zoom-in"> <i class="schk-icon-zoom-in schk-icon-24"></i> </div> <div class="zoom__round-btn js-schk-zoom-out"> <i class="schk-icon-zoom-out schk-icon-24"></i> </div> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._selectTickets='<div class="b-registration__section js-section-selectTickets"> {{#event.uses_ticket_choice}} {{#event.tickets.length}} <h5 class="b-unit__header_size_small b-registration__header b-indentable"> {{#event.uses_multireg}} Выберите тип билетов: {{/event.uses_multireg}} {{^event.uses_multireg}} {{#event.has_active_places}} Или выберите тип билета: {{/event.has_active_places}} {{^event.has_active_places}} Выберите тип билета: {{/event.has_active_places}} {{/event.uses_multireg}} </h5> {{/event.tickets.length}} {{/event.uses_ticket_choice}} {{^event.promocode_locked}} <div class="row-fluid b-reg-table b-reg-table_type_striped"> <div class="span12"> {{#event.uses_ticket_choice}} {{#event.tickets.length}} <div class="row-fluid b-reg-table__row b-reg-table__row_header"> <div class="{{#event.uses_multireg}}span6{{/event.uses_multireg}}{{^event.uses_multireg}}span9{{/event.uses_multireg}} b-reg-table__cell b-reg-table__cell-name"> <h3 class="b-reg-table__header b-reg-table__text">Тип билета</h3> </div> <div class="span3 b-reg-table__cell b-reg-table__cell-price"> <h3 class="b-reg-table__header b-reg-table__text">Цена</h3> </div> {{#event.uses_multireg}} <div class="span2 b-reg-table__cell b-reg-table__cell-count"> <h3 class="b-reg-table__header b-reg-table__text"> <span>Кол&#8209;во</span> </h3> </div> {{/event.uses_multireg}} </div> {{/event.tickets.length}} {{#event.tickets}} <div class="row-fluid b-reg-table__row {{#has_promocode}}b-reg-table__row_type_promo{{/has_promocode}}" id="rei_cont_{{id}}"> <div class="{{#event.uses_multireg}}span6{{/event.uses_multireg}}{{^event.uses_multireg}}span9{{/event.uses_multireg}} b-reg-table__cell b-reg-table__cell-name {{^event.uses_multireg}}b-reg-table__cell-name_full-width{{/event.uses_multireg}}"> <label class="b-reg-table__text {{^event.uses_multireg}} b-reg-table__text_with_radio{{/event.uses_multireg}}" for="rei_{{id}}"> {{^event.uses_multireg}} <input {{#force_check}}checked="checked"{{/force_check}} type="radio" class="b-reg-table__select b-radio_where_table" name="re_id" data-reid="{{id}}" value="{{id}}" id="rei_{{id}}" {{^available}}disabled="disabled"{{/available}}> {{/event.uses_multireg}} {{{name}}} </label> <div class="js-reg-table-pricing b-reg-table__price-mobile{{^event.uses_multireg}} b-reg-table__price-mobile_non-multireg{{/event.uses_multireg}}"> <span class="js-reg-table-price">{{h_price}}</span> <span class="js-reg-table-discount b-reg-table__price-discount">{{h_discount}}</span> </div> {{#comment}} <span class="help-block b-reg-table__category-description {{^event.uses_multireg}}b-reg-table__category-description_type_multireg{{/event.uses_multireg}}">{{{comment}}}</span> {{/comment}} {{#text_tickets_remain}} <span class="help-block b-reg-table__category-description {{^event.uses_multireg}}b-reg-table__category-description_type_multireg{{/event.uses_multireg}}">{{{text_tickets_remain}}}</span> {{/text_tickets_remain}} {{^event.uses_multireg}} <span class="help-block b-reg-table__category-description b-reg-table__category-description_type_multireg">Закрытие регистрации {{ttl}}</span> {{/event.uses_multireg}} </div> <div class="span3 span3_fixed-width b-reg-table__cell b-reg-table__cell-price"> <span class="b-reg-table__text b-not-bold js-reg-table-price">{{h_price}}</span> <p class="b-reg-table__text js-reg-table-discount">{{h_discount}}</p> </div> <div class="{{#event.uses_multireg}}span2{{/event.uses_multireg}}{{^event.uses_multireg}}span4{{/event.uses_multireg}} b-reg-table__cell b-reg-table__cell-count"> {{#available}} {{#event.uses_multireg}} {{^settings.use_plusminus}} <select class="b-reg-table__select" name="res[{{id}}]" data-reid="{{id}}" id="rei_{{id}}"> <option value="0">&mdash;</option> {{#ticket_choices}} <option value="{{val}}" {{#selected}}selected="selected"{{/selected}}>{{val}}</option> {{/ticket_choices}} </select> {{/settings.use_plusminus}} {{#settings.use_plusminus}} <div class="b-reg-table__plusminus js-plusminus" data-plusminus-min="{{min}}" data-plusminus-max="{{max}}"> <button class="b-reg-table__plusminus_btn not-touch js-svoge-fallback js-plusminus_minus" type="button"> <img src="{{host}}img/svoge-pixel.png" alt="" class="svoge" data-svoge="svg-twf2-plusminus-minus" data-svoge-class=""> </button> <span class="b-reg-table__plusminus-value js-plusminus_display">{{default_count}}</span> <input class="js-tickets_count_input js-plusminus_value" type="hidden" name="res[{{id}}]" data-reid="{{id}}" id="rei_{{id}}" autocomplete="nein" value="{{default_count}}"> <button class="b-reg-table__plusminus_btn js-svoge-fallback not-touch js-plusminus_plus" type="button"> <img src="{{host}}img/svoge-pixel.png" alt="" class="svoge" data-svoge="svg-twf2-plusminus-plus" data-svoge-class=""> </button> </div> {{/settings.use_plusminus}} {{/event.uses_multireg}} <span class="hide multiank_counter b-reg-table__text">0</span> {{/available}} {{^available}} недоступно {{/available}} </div> </div> {{/event.tickets}} {{/event.uses_ticket_choice}} {{^event.uses_ticket_choice}} {{#event.tickets}} <input type="hidden" name="re_id" class="b-reg-table__hidden" data-reid="{{id}}" value="{{id}}" id="rei_{{id}}"> {{/event.tickets}} {{/event.uses_ticket_choice}} <div class="row-fluid b-reg-table__row"> <div class="span12 b-reg-table__cell"> <div class="selectedTicketsInfo b-reg-table__text"></div> </div> </div> </div> </div> {{/event.promocode_locked}} </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._support='<div class="b-event__support-info"> <div class="b-unit__header_size_mid">Связь с техподдержкой:</div> <div class="row-fluid b-event__info-elem"> <div class="span2"> <span class="b-unit__text b-unit__text_color_gray">Телефоны:</span> </div> <div class="span6"> <span class="b-unit__text b-unit__text_color_black">{{phone_moscow}}<br>{{phone_russia}}</span> </div> </div> <div class="row-fluid b-event__info-elem"> <div class="span2"> <span class="b-unit__text b-unit__text_color_gray">Время работы:</span> </div> <div class="span6"> <span class="b-unit__text b-unit__text_color_black">{{event.business_hours_weekday}}<br>{{event.business_hours_weekend}}</span> </div> </div> <div class="row-fluid b-event__info-elem"> <div class="span2"> <span class="b-unit__text b-unit__text_color_gray">E-mail:</span> </div> <div class="span6"> <a class="b-unit__text b-unit__text_color_black" href="mailto:support@timepad.ru">support@timepad.ru</a> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls._timer='<div class="b-registration__section"> <div class="js-timer twf2-timer"> <div class="twf2-timer__left"> <span class="twf2-timer-text">Время оплаты заказа ограничено! До окончания платежной сессии:</span> <span class="twf2-timer-text_retry">Платежная сессия завершена. Нажмите «Далее» для продолжения оплаты.</span> </div> <div class="twf2-timer__right"> <div class="twf2-timer__container"> <div class="js-timer-clock twf2-timer__clock"></div> <div class="js-timer-retry twf2-timer__retry"> <a href="#" class="js-timer-retry-btn twf-2-timer__retry-btn">Далее</a> </div> </div> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.button='<button class="btn btn-large btn-info b-pro-widget__open-button open_widget">Зарегистрироваться</button>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.charity='<div class="i-page"> {{#isInTimepad}} <div class="b-registration__section_indent"> {{^isInPaymentPage}} <h1 class="b-payment__header"> Благотворительный взнос </h1> {{/isInPaymentPage}} </div> {{/isInTimepad}} <div class="b-registration__section b-registration__section_indent"> {{^isInTimepad}} <h2 class="b-unit__header b-unit__header_size_mid b-unit__header_payment_main"> Благотворительный взнос </h2> {{/isInTimepad}} </div> <div class="row-fluid b-reg-table b-reg-table_type_striped b-payment__tickets"> <div> <div class="row-fluid b-reg-table__row"> <div class="span10 b-reg-table__cell"> <span class="b-reg-table__text">Благотворительный взнос</span> </div> <div class="span2 b-reg-table__cell"> <span class="b-reg-table__text">{{order.charity_payment.sum}} руб.</span> </div> </div> <div class="row-fluid b-reg-table__row"> <div class="span10 b-reg-table__cell"> <span class="b-reg-table__text"> Всего к оплате {{order.charity_payment.sum}} руб. </span> </div> </div> </div> </div> {{#order.charity_payment.cardPaymentActive}} {{> _cloudpay}} {{/order.charity_payment.cardPaymentActive}} <div class="b-registration__section b-registration__section_indent"> {{#order.charity_payment.paymentMethods}} <div class="b-payment"> <h5 class="b-unit__header_size_small b-registration__header">Выберите способ оплаты:</h5> {{#order.charity_payment.paymentMethods.link}} <a href="{{#available}}{{url}}{{/available}}{{^available}}javascript:false{{/available}}" class="b-payment__method {{#available}}redirect{{/available}} {{^available}}b-payment__method-disabled{{/available}}"> <img class="b-payment__method-icon" src="{{host}}img/paybutton/{{button}}_ru.png"> <span class="b-payment__method-label">{{label}}</span> {{#comment}}<span class="b-payment__method-comment">{{comment}}</span>{{/comment}} </a> {{/order.charity_payment.paymentMethods.link}} </div> {{/order.charity_payment.paymentMethods}} {{> _support}} {{> _faq}} </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.main='<div class="i-page"> {{> _header_image}} {{#event.is_recurring}} <div class="b-registration__section b-registration__section_indent"> <div class="b-date-choice__day"> {{selectedRecurringEvent.date_h}} <a class="js-open-date-choice b-date-choice__select-date" href="#">Выбрать другую дату</a> </div> </div> {{/event.is_recurring}} <div class="b-registration__section"> {{#event.texts.reg_desc}} <p class="b-reg-descr">{{{event.texts.reg_desc}}}</p> {{/event.texts.reg_desc}} </div> {{> _promocodeBlock}} <form id="eventreg_form" action="{{event.domain}}event/widget_register/{{event.id}}"> {{#event.uses_places}} {{#event.has_active_places}} {{> _seatcheck}} {{/event.has_active_places}} {{/event.uses_places}} {{> _selectTickets}} {{^event.promocode_locked}} {{#event.uses_multiank}} <div class="b-registration__section hide section-multiankadd"> <div class="b-add-attendees"> <a class="b-pro-wiget__reg-button b-pro-widget__reg-button_multiank add-attendees" href="">Заполнить анкеты</a> </div> </div> {{/event.uses_multiank}} {{> _branding }} <div class="b-registration__section b-registration__section_no-bottom-space"> <div class="b-registration__error hide"></div> </div> {{> _ank }} {{/event.promocode_locked}} </form> <div class="b-registration__bottom"></div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.pay='<div class="i-page"> {{#isInTimepad}} <div class="b-registration__section_indent"> {{^isInPaymentPage}} <h1 class="b-payment__header"> Оплата участия <div class="b-payment__help"> <a target="_blank" href="http://help.timepad.ru/5588?kb_language={{#event.locale_ru}}ru_RU{{/event.locale_ru}}{{^event.locale_ru}}en_US{{/event.locale_ru}}"> <img class="svoge" src="https://timepad.ru/img/svoge-pixel.png" data-svoge="glyphicon-question-sign"> Как оплатить, получить или вернуть билет? </a> </div> </h1> {{#showEventDetailsAtPayment}} {{! При оплате по ссылке — подробная инфа о событии !}} <div class="b-payment__info"> <h5 class="b-payment__info-header">Информация о событии</h5> <table class="b-payment__info-body"> {{#event.name}} <tr> <td class="b-payment__info-field">Название</td> <td class="b-payment__info-value">{{{event.name}}}</td> </tr> {{/event.name}} {{#event.datetime}} <tr> <td class="b-payment__info-field">Дата</td> <td class="b-payment__info-value">{{event.datetime}}</td> </tr> {{/event.datetime}} {{#event.place}} <tr> <td class="b-payment__info-field">Адрес</td> <td class="b-payment__info-value">{{#event.city}}{{event.city}}, {{/event.city}}{{{event.place}}}</td> </tr> {{/event.place}} </table> </div> {{/showEventDetailsAtPayment}} {{/isInPaymentPage}} </div> {{/isInTimepad}} {{! #event.image}} {{! > _header_image}} {{! /event.image}} <div class="b-registration__section b-registration__section_indent"> {{^isInTimepad}} <h2 class="b-unit__header b-unit__header_size_mid b-unit__header_payment_main"> Оплата участия </h2> {{> _registrant}} {{/isInTimepad}} </div> {{> _order}} {{> _branding }} {{> _timer}} {{#order.payment.cardCloudPaymentActive}} {{> _cloudpay}} {{/order.payment.cardCloudPaymentActive}} <div class="b-registration__section b-registration__section_indent"> {{#order.payment.paymentMethods}} <div class="b-payment"> {{#show_vkpay_button}} <h5 class="b-unit__header_size_small b-registration__header">Оплатите с помощью VK Pay:</h5> <a href="#" class="b-payment__method b-payment__method_vkpay js-vkpay"> <img class="b-payment__vkpay-btn-logo" src="{{host}}img/paybutton/vkpay_big.png"> </a> {{/show_vkpay_button}} <h5 class="b-unit__header_size_small b-registration__header"> {{#show_vkpay_button}} Или выберите другой способ оплаты: {{/show_vkpay_button}} {{^show_vkpay_button}} Выберите способ оплаты: {{/show_vkpay_button}} </h5> {{#order.payment.paymentMethods.link}} <a href="{{#available}}{{url}}{{/available}}{{^available}}javascript:false{{/available}}" class="b-payment__method {{#available}}redirect{{/available}} {{^available}}b-payment__method-disabled{{/available}}"> <img class="b-payment__method-icon" src="{{host}}img/paybutton/{{button}}_ru.png"> <span class="b-payment__method-label">{{label}}</span> {{#comment}}<span class="b-payment__method-comment">{{comment}}</span>{{/comment}} </a> {{/order.payment.paymentMethods.link}} </div> {{#order.payment.topComission}} <div class="b-registration__notice"> Сумма включает сервисный сбор: {{order.payment.topComission_human}} </div> {{/order.payment.topComission}} {{#order.pay_till}} \x3c!--div class="b-registration__notice"> <div class="b-registration__notice-heading">Внимание!</div> Время брони билета ограничено. Бронь будет снята {{order.pay_till_relative}}. </div--\x3e {{/order.pay_till}} {{/order.payment.paymentMethods}} {{^order.payment.paymentMethods}} <div class="b-registration__notice no-contract__notice"> К сожалению, организатор этого события решил не продавать билеты он-лайн. Чтобы узнать, как вы можете оплатить свое участие, свяжитесь с ним. <div class="send-pay-request"> <a href="#" class="b-pro-widget__btn_small">Отправить заявку на оплату</a> </div> </div> {{/order.payment.paymentMethods}} {{> _support}} {{> _faq}} </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.pending='<div class="i-page i-jquery i-less i-bootstrap section-pending"> <div class="b-registration__section"> <h2 class="b-unit__header b-unit__header_size_mid"> <img src="{{host}}img/reg2assets/reg-star.png">Подтверждение приема заявки </h2> <div class="b-reg-descr"> {{{event.texts.reg_pending}}} </div> </div> <div class="b-registration__section"> {{> _registrant}} {{> _order}} </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.select_date='<div class="i-page"> {{> _header_image}} <div class="b-registration__section b-registration__section_indent"> {{#event.has_recurring_events_by_day}} <div class="b-date-choice__header"> Выберите дату и время </div> {{/event.has_recurring_events_by_day}} <div class="b-date-choice"> {{#event.recurring_events_by_day}} {{^squishRecurringDates}} <div class="b-date-choice__day"> {{day}}, {{day_of_week}} </div> {{/squishRecurringDates}} {{#events}} <div class="js-date-choice b-date-choice__event {{#isCurrent}}b-date-choice__event_status_active{{/isCurrent}} {{#unavaliable}}b-date-choice__event_status_inactive{{/unavaliable}}" data-event-id="{{id}}"> <div class="b-date-choice__row"> <div class="b-date-choice__col1"> {{#squishRecurringDates}}{{day}}, {{day_of_week}}, {{/squishRecurringDates}} {{time}} </div> <div class="b-date-choice__col2"> {{#tickets_limited}}{{tickets_left_h}}{{/tickets_limited}} {{^tickets_limited}}&nbsp;{{/tickets_limited}} </div> <div class="b-date-choice__col3"> {{^unavaliable}}{{min_price_h}}{{/unavaliable}} {{#unavaliable}}Нет в продаже{{/unavaliable}} </div> </div> </div> {{/events}} {{/event.recurring_events_by_day}} {{^event.recurring_events_by_day}} {{{event.texts.reg_closed}}} {{/event.recurring_events_by_day}} </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.select_date_vertical='<div class="i-page"> <div class="b-registration__section b-registration__section_indent"> {{#event.has_recurring_events_by_day}} <div class="b-date-choice__header"> Выберите дату и время </div> {{/event.has_recurring_events_by_day}} <div class="js-tooltip schk-tooltip"> <div class="schk-tooltip__wrap" style="min-width: 89px;"> <div class="schk-tooltip__row schk-tooltip__row_cat"> <div class="schk-tooltip__b schk-tooltip__b_cat-name">Свободных мест</div> </div> <div class="schk-tooltip__row schk-tooltip__row_price"> <div class="js-tooltip-tickets-left schk-tooltip__b schk-tooltip__b_price"></div> </div> </div> <div class="schk-tooltip__arrow schk-tooltip__arrow_bottom"></div> </div> <div class="b-date-choice_vertical js-gridscroller" data-disabled-class="__pager_disabled"> <div class="__pager_left js-gridscroller__left"> <img src="{{host}}img/svoge-pixel.png" alt="" class="svoge" data-svoge="svg-twf2-scroll-left" data-svoge-class=""> </div> <div class="__pager_right js-gridscroller__right"> <img src="{{host}}img/svoge-pixel.png" alt="" class="svoge" data-svoge="svg-twf2-scroll-right" data-svoge-class=""> </div> <div class="__scroll_container js-gridscroller__container"> <div class="__scroll_inner-container js-gridscroller__inner-container"> <div class="__mover js-gridscroller__mover"> <table class="__table bc_c"> {{#event.recurring_events_grid}} <tr> {{#cells}} <td class="__outer_cell {{#is_header}}__header js-gridscroller__header{{/is_header}} {{#is_weekend}}__header_weekend{{/is_weekend}} js-gridscroller__cell"> <div class="__cell"> {{#is_header}} <div class="__wday">{{day_of_week}}</div> <div class="__day">{{day_month}}</div> {{/is_header}} {{#events}} <div class="js-date-choice __time {{#isCurrent}}__time_active{{/isCurrent}} {{#unavaliable}}__time_inactive{{/unavaliable}}" data-event-id="{{id}}" {{#tickets_limited}}data-event-tickets-left="{{tickets_left}}" data-event-tickers-reglimit="{{tickers_reglimit}}"{{/tickets_limited}}> {{time}} </div> {{/events}} </div> </td> {{/cells}} </tr> {{/event.recurring_events_grid}} {{^event.recurring_events_by_day}} {{{event.texts.reg_closed}}} {{/event.recurring_events_by_day}} </table> </div> </div> </div> </div> </div> </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.success='<div class="i-page i-jquery i-less i-bootstrap"> {{> _header_image}} <div class="b-registration__section b-registration__section_indent b-registration__section_text"> <h2 class="b-unit__header b-unit__header_size_mid"> Спасибо за регистрацию! </h2> </div> {{#order.charity_payment.paid}} <div class="b-registration__section b-registration__section_success l-units"> {{> _charity_ok_text }} </div> {{/order.charity_payment.paid}} <div class="b-registration__section b-registration__section_text b-registration__section_indent"> {{{event.texts.reg_success}}} </div> <div class="b-registration__section b-registration__section_indent"> {{> _registrant}} </div> <div class="b-registration__section"> {{> _order}} </div> {{#event.has_checkout_promotions}} <div class="b-registration__section b-registration__section_indent b-registration__section_text"> <h2 class="b-unit__header b-unit__header_size_mid"> Возможно, вас заинтересует: </h2> </div> <div class="b-registration__section b-registration__section_indent"> <div class="b-promoted-links"> {{#event.checkout_promotions}} <div class="b-promoted-links__block"> <a href="{{url}}" class="b-promoted-links__img" style="background-image:url({{img_src}})" target="_blank"></a> <a href="{{url}}" class="b-promoted-links__link" target="_blank"> {{text}} </a> </div> {{/event.checkout_promotions}} </div> </div> {{/event.has_checkout_promotions}} {{#isInTimepad}} {{#event.uses_ads}} {{#order.uses_ads}} {{#order.show_diploma}} {{> _banner_diploma}} {{/order.show_diploma}} {{^order.show_diploma}} {{> _banner_flocktory}} {{/order.show_diploma}} {{/order.uses_ads}} {{/event.uses_ads}} {{#order.kinopoisk_code}} {{> _banner_kinopoisk}} {{/order.kinopoisk_code}} {{/isInTimepad}} </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.tickets='<div class="i-page"> {{> _header_image}} <div class="b-registration__section b-registration__section_success"> <h3 class="b-unit__header b-unit__header_size_mid_small"> {{#order.payment}}Оплата успешна!{{/order.payment}} {{^order.payment}}Спасибо за регистрацию!{{/order.payment}} </h3> <p> Распечатайте ваши билеты прямо сейчас, если у вас есть возможность. Мы также отправили ссылки на них на почту <a href="mailto:{{order.email}}">{{order.email}}</a> Если билеты не пришли, пожалуйста, напишите нам об этом на <a href="mailto:support@timepad.ru">support@timepad.ru</a>. В письме обязательно укажите событие, на которое вы их покупали. </p> {{#order.charity_payment.paid}} {{> _charity_ok_text }} {{/order.charity_payment.paid}} </div> <div class="b-registration__section b-registration__section_text b-registration__section_indent"> {{{event.texts.reg_success}}} </div> <div class="b-registration__section"> <h2 class="b-unit__header b-unit__header_size_large"> Ваши билеты. Распечатайте их сейчас. </h2> </div> <div class="b-registration__section js-tickets"> {{#order.tickets}} <div class="b-tickets-table__row js-ticket b-printable-ticket" data-ticket-id="{{id}}"> <button class="js-print-ticket b-printable-ticket__button">Распечатать</button> <span class="b-reg-table__text">{{{cat_name}}}</span> <span class="help-block b-tickets-table__description"> <a href="{{view_link}}" target="_blank" class="js-ticket-view-link">Билет №{{code}}</a> </span> {{#personal_link}} <div class="b-reg-table__delimiter"></div> <span class="b-reg-table__text b-reg-table__text_extra">{{personal_link_title}}</span> <span class="help-block b-tickets-table__description"> <a href="{{personal_link}}" target="_blank" class="js-ticket-view-link">{{personal_link}}</a> </span> {{/personal_link}} </div> {{/order.tickets}} </div> {{#event.has_checkout_promotions}} <div class="b-registration__section b-registration__section_indent b-registration__section_text"> <h2 class="b-unit__header b-unit__header_size_mid"> Возможно, вас заинтересует: </h2> </div> <div class="b-registration__section b-registration__section_indent"> <div class="b-promoted-links"> {{#event.checkout_promotions}} <div class="b-promoted-links__block"> <a href="{{url}}" class="b-promoted-links__img" style="background-image:url({{img_src}})" target="_blank"></a> <a href="{{url}}" class="b-promoted-links__link" target="_blank"> {{text}} </a> </div> {{/event.checkout_promotions}} </div> </div> {{/event.has_checkout_promotions}} {{> _branding.thanks}} {{#isInTimepad}} {{#event.uses_ads}} {{#order.uses_ads}} {{#order.show_diploma}} {{> _banner_diploma}} {{/order.show_diploma}} {{/order.uses_ads}} {{/event.uses_ads}} {{#order.kinopoisk_code}} {{> _banner_kinopoisk}} {{/order.kinopoisk_code}} {{/isInTimepad}} </div>',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.tlen='<div class="i-page i-jquery i-less i-bootstrap"> <div class="b-registration__section" style="border-bottom: none;"> <h2 class="b-unit__header b-unit__header_size_mid"> Регистрация на событие закрыта </h2> <div class="b-registration__notice"> {{{event.texts.reg_closed}}} </div> </div> </div> ',window.TWF2.WidgetPrototypes.event_register.prototype._tpls.widget_error='<div style="margin: 1em;" class="i-page"> <h2>{{error.header}}</h2> <p> {{error.message}} {{#error.support}}Пожалуйста, сообщите об этом по адресу <a href="mailto:support@timepad.ru">support@timepad.ru</a> и пришлите ссылку на эту страницу.{{/error.support}} </p> {{#error.fallback}} <p style="margin-top: 1em;">Вы можете попробовать зарегистрироваться на событие через систему TimePad:</p> <p style="margin: .6em 0;"><a href="{{error.fallback_url}}" class="btn btn-large btn-info" target="_blank">Перейти к регистрации</a></p> {{/error.fallback}} </div> ';